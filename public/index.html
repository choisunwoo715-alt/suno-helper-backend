<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Suno AI Shorts Helper Pro v11.0 GLOBAL Edition</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Pretendard:wght@400;600;700&display=swap');
        body { font-family: 'Pretendard', sans-serif; background-color: #0f172a; color: #f1f5f9; }
        .glass { background: rgba(30, 41, 59, 0.7); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.1); }
        .output-box { min-height: 150px; }
        .shimmer { background: linear-gradient(90deg, #1e293b 25%, #334155 50%, #1e293b 75%); background-size: 200% 100%; animation: shimmer 1.5s infinite; }
        @keyframes shimmer { 0% { background-position: 200% 0; } 100% { background-position: -200% 0; } }
        .badge { display: inline-block; padding: 4px 12px; border-radius: 12px; font-size: 11px; font-weight: 600; margin-left: 8px; }
        .badge-gemini3 { background: linear-gradient(135deg, #22c55e, #3b82f6); color: #fff; box-shadow: 0 0 10px rgba(34, 197, 94, 0.5); }
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #1e293b; }
        ::-webkit-scrollbar-thumb { background: #475569; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #64748b; }
        
        /* Placeholder ìŠ¤íƒ€ì¼ - í™•ì‹¤íˆ ë³´ì´ê²Œ! */
        input::placeholder,
        textarea::placeholder {
            color: rgba(148, 163, 184, 0.7) !important;
            opacity: 1 !important;
        }
        
        input::-webkit-input-placeholder,
        textarea::-webkit-input-placeholder {
            color: rgba(148, 163, 184, 0.7) !important;
        }
        
        input::-moz-placeholder,
        textarea::-moz-placeholder {
            color: rgba(148, 163, 184, 0.7) !important;
            opacity: 1 !important;
        }
        
        input:-ms-input-placeholder,
        textarea:-ms-input-placeholder {
            color: rgba(148, 163, 184, 0.7) !important;
        }
        
        .floating-copy-bar { position: fixed; bottom: 30px; right: 30px; z-index: 100; animation: slideInRight 0.5s ease-out; }
        @keyframes slideInRight { from { transform: translateX(400px); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
        .floating-copy-bar.hidden { display: none; }
        
        .ai-report { background: linear-gradient(135deg, rgba(34, 197, 94, 0.1), rgba(59, 130, 246, 0.1)); border: 1px solid rgba(34, 197, 94, 0.3); }
        
        .toggle-checkbox:checked { background-color: #10b981; border-color: #10b981; }
        .toggle-checkbox:checked + .toggle-label { color: #10b981; }
        .toggle-checkbox { appearance: none; width: 44px; height: 24px; background: #475569; border-radius: 12px; position: relative; cursor: pointer; transition: all 0.3s; border: 2px solid #475569; }
        .toggle-checkbox:checked::before { transform: translateX(20px); }
        .toggle-checkbox::before { content: ''; position: absolute; width: 16px; height: 16px; border-radius: 50%; background: white; top: 2px; left: 2px; transition: transform 0.3s; }

        /* v9.2: í¸ì§‘ ëª¨ë“œ */
        .editable-on { outline: none; border: 1px solid rgba(59,130,246,.6) !important; box-shadow: 0 0 0 2px rgba(59,130,246,.15); }
        .editable-hint { font-size: 10px; color: #94a3b8; }
        
        /* ì´ˆê¸° ì•ˆë‚´ í…ìŠ¤íŠ¸ - ê±°ì˜ ë¶ˆíˆ¬ëª…í•˜ê²Œ! */
        .placeholder-text {
            color: rgba(148, 163, 184, 0.85) !important;
        }
        
        /* v9.2: ì ‘ê¸°/í¼ì¹˜ê¸° ì• ë‹ˆë©”ì´ì…˜ */
        .collapsible-section { transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1); overflow: hidden; }
        .collapsible-section.collapsed { max-height: 0 !important; opacity: 0; padding-top: 0 !important; padding-bottom: 0 !important; margin-top: 0 !important; margin-bottom: 0 !important; }
        .collapsible-section.expanded { max-height: 3000px; opacity: 1; }
        .collapse-header { cursor: pointer; transition: all 0.3s; user-select: none; }
        .collapse-header:hover { background: rgba(59, 130, 246, 0.1); }
        .collapse-icon { transition: transform 0.3s; }
        .collapse-icon.rotated { transform: rotate(180deg); }
        
        /* ğŸ”¥ v10.5: íƒ­ ìŠ¤íƒ€ì¼ */
        .tab-button { 
            background: rgba(51, 65, 85, 0.5); 
            color: rgba(148, 163, 184, 0.8); 
            border: 2px solid transparent;
            cursor: pointer;
        }
        .tab-button:hover { 
            background: rgba(71, 85, 105, 0.6); 
            color: rgba(203, 213, 225, 1);
        }
        .tab-button.active { 
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.2), rgba(59, 130, 246, 0.2));
            color: rgb(167, 243, 208); 
            border-color: rgba(16, 185, 129, 0.5);
            box-shadow: 0 0 20px rgba(16, 185, 129, 0.3);
        }
        
        .tab-content { 
            display: none; 
            animation: fadeIn 0.3s ease-in-out;
        }
        .tab-content.active { 
            display: block; 
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* ğŸŒŸ v10.5: ê°„í¸/ê³ ê¸‰ ëª¨ë“œ ìŠ¤íƒ€ì¼ */
        .mode-toggle {
            display: flex;
            gap: 8px;
            margin-bottom: 24px;
            padding: 4px;
            background: rgba(30, 41, 59, 0.5);
            border-radius: 12px;
            backdrop-filter: blur(10px);
        }
        
        .mode-btn {
            flex: 1;
            padding: 12px 20px;
            border: 2px solid transparent;
            border-radius: 10px;
            background: transparent;
            color: rgba(148, 163, 184, 0.8);
            font-weight: bold;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .mode-btn:hover {
            background: rgba(71, 85, 105, 0.3);
            color: rgba(203, 213, 225, 1);
        }
        
        .mode-btn.active {
            background: linear-gradient(135deg, rgba(250, 204, 21, 0.2), rgba(251, 191, 36, 0.2));
            color: rgb(253, 224, 71);
            border-color: rgba(250, 204, 21, 0.5);
            box-shadow: 0 0 20px rgba(250, 204, 21, 0.3);
        }
        
        .simple-mode, .advanced-mode {
            display: none;
            animation: fadeIn 0.4s ease-in-out;
        }
        
        .simple-mode.active, .advanced-mode.active {
            display: block;
        }
        
        /* ê°„í¸ ëª¨ë“œ - ë‹¨ê³„ë³„ UI */
        .step {
            margin-bottom: 32px;
            padding: 24px;
            background: rgba(30, 41, 59, 0.3);
            border-radius: 16px;
            border: 2px solid rgba(59, 130, 246, 0.2);
        }
        
        .step h3 {
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 16px;
            color: rgb(167, 243, 208);
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .step-desc {
            font-size: 14px;
            color: rgba(148, 163, 184, 0.9);
            margin-bottom: 16px;
        }
        
        /* í° ì…ë ¥ì°½ */
        .big-input {
            width: 100%;
            padding: 20px;
            font-size: 18px;
            line-height: 1.6;
            background: rgba(15, 23, 42, 0.6);
            border: 2px solid rgba(16, 185, 129, 0.3);
            border-radius: 12px;
            color: white;
            outline: none;
            transition: all 0.3s;
            min-height: 120px;
            resize: vertical;
        }
        
        .big-input:focus {
            border-color: rgba(16, 185, 129, 0.6);
            box-shadow: 0 0 20px rgba(16, 185, 129, 0.2);
        }
        
        .big-input::placeholder {
            color: rgba(148, 163, 184, 0.7) !important;
            font-size: 13px;
        }
        
        /* ì¥ë¥´ ì¹´ë“œ ê·¸ë¦¬ë“œ */
        .genre-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
        }
        
        .genre-card {
            padding: 24px;
            background: rgba(30, 41, 59, 0.5);
            border: 3px solid rgba(71, 85, 105, 0.5);
            border-radius: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 12px;
            text-align: center;
        }
        
        .genre-card:hover {
            background: rgba(51, 65, 85, 0.6);
            border-color: rgba(16, 185, 129, 0.5);
            transform: translateY(-4px);
            box-shadow: 0 8px 24px rgba(16, 185, 129, 0.2);
        }
        
        .genre-card.selected {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.2), rgba(59, 130, 246, 0.2));
            border-color: rgba(16, 185, 129, 0.8);
            box-shadow: 0 0 30px rgba(16, 185, 129, 0.4);
        }
        
        .genre-card .icon {
            font-size: 48px;
            line-height: 1;
        }
        
        .genre-card .label {
            font-size: 18px;
            font-weight: bold;
            color: white;
        }
        
        .genre-card .desc {
            font-size: 13px;
            color: rgba(148, 163, 184, 0.8);
        }
        
        /* ë©”ê°€ ìƒì„± ë²„íŠ¼ */
        .mega-button {
            width: 100%;
            padding: 28px 40px;
            background: linear-gradient(135deg, #10b981, #3b82f6, #8b5cf6);
            background-size: 200% 200%;
            border: none;
            border-radius: 16px;
            font-size: 24px;
            font-weight: bold;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 8px 32px rgba(16, 185, 129, 0.3);
            position: relative;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
        }
        
        .mega-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 40px rgba(16, 185, 129, 0.5);
            background-position: 100% 0;
        }
        
        .mega-button:active {
            transform: translateY(0);
        }
        
        .mega-button .sub {
            font-size: 14px;
            font-weight: normal;
            opacity: 0.9;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
    </style>
</head>
<body class="p-4 md:p-8">
    <div class="max-w-7xl mx-auto">
        <header class="flex justify-between items-center mb-8">
            <div>
                <h1 class="text-3xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-green-400 to-blue-500">
                    Suno AI Shorts Helper Pro
                    <span class="badge badge-gemini3">v11.0 GLOBAL ğŸŒ</span>
                </h1>
                <p class="text-slate-400 mt-1">í¸ì§‘ ëª¨ë“œ â€¢ ìƒì„± ì·¨ì†Œ â€¢ ê³¡ ì—°ì¥(Extend) â€¢ 17ì¢… ì¥ë¥´ (ê¸€ë¡œë²Œ íˆíŠ¸ íŒ© ì¶”ê°€!) ğŸ”¥</p>
            </div>
            <div class="flex gap-2">
                <button id="btn-clear-all" class="p-2 px-4 glass rounded-full hover:bg-red-700 flex items-center gap-2 transition-all border border-red-500/30" title="ëª¨ë“  ì¶œë ¥ ë‚´ìš© ì´ˆê¸°í™”">
                    <i class="fas fa-trash-alt text-red-400"></i> <span class="hidden md:inline text-red-300">ì „ë¶€ ë¹„ìš°ê¸°</span>
                </button>
                <button id="btn-history" class="p-2 px-4 glass rounded-full hover:bg-slate-700 flex items-center gap-2 transition-all">
                    <i class="fas fa-history"></i> <span class="hidden md:inline">ë³´ê´€í•¨</span>
                </button>
                <button id="btn-settings" class="p-2 px-4 glass rounded-full hover:bg-slate-700 transition-all">
                    <i class="fas fa-cog"></i>
                </button>
            </div>
        </header>

        <!-- Settings Modal -->
        <div id="settings-modal" class="hidden fixed inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm">
            <div class="glass p-6 rounded-2xl w-full max-w-md mx-4 max-h-[90vh] overflow-y-auto">
                <h2 class="text-xl font-bold mb-4 flex items-center gap-2"><i class="fas fa-key text-yellow-400"></i> API ì„¤ì •</h2>
                
                <!-- Gemini API -->
                <div class="mb-6 pb-6 border-b border-slate-700">
                    <label class="block text-xs text-slate-400 mb-1">Gemini API Key</label>
                    <input id="api-key" type="password" placeholder="Gemini API Key ì…ë ¥" class="w-full p-3 glass rounded-xl mb-3 focus:ring-2 focus:ring-blue-500 outline-none">
                    
                    <label class="block text-xs text-slate-400 mb-1">ëª¨ë¸ ì„ íƒ</label>
                    <select id="model-select" class="w-full p-3 glass rounded-xl mb-4 focus:ring-2 focus:ring-blue-500 outline-none cursor-pointer bg-slate-800">
                        <option value="gemini-3-flash-preview" selected>gemini-3-flash-preview (ìµœì‹ /ë¬´ë£Œ) ğŸ”¥</option>
                        <option value="gemini-3-pro-preview">gemini-3-pro-preview (ìµœì‹ /í”„ë¡œ) ğŸ’</option>
                        <option value="gemini-2.5-flash">gemini-2.5-flash (ì•ˆì •íŒ) âš¡</option>
                    </select>
                </div>

                <!-- Google Cloud TTS -->
                <div class="mb-6 pb-6 border-b border-slate-700">
                    <div class="flex items-center justify-between mb-3">
                        <h3 class="text-sm font-semibold flex items-center gap-2">
                            <i class="fas fa-microphone text-purple-400"></i>
                            Google Cloud TTS (ê³ í’ˆì§ˆ ìŒì„±)
                        </h3>
                        <label class="flex items-center gap-3 cursor-pointer">
                            <input type="checkbox" id="tts-enable" class="toggle-checkbox">
                            <span class="toggle-label text-sm">ì‚¬ìš©</span>
                        </label>
                    </div>
                    
                    <label class="block text-xs text-slate-400 mb-1">Google Cloud API Key</label>
                    <input id="tts-api-key" type="password" placeholder="Google Cloud API Key ì…ë ¥" class="w-full p-3 glass rounded-xl mb-3 focus:ring-2 focus:ring-purple-500 outline-none">
                    
                    <label class="block text-xs text-slate-400 mb-1">ìŒì„± ì„ íƒ</label>
                    <select id="tts-voice-select" class="w-full p-3 glass rounded-xl focus:ring-2 focus:ring-purple-500 outline-none cursor-pointer bg-slate-800">
                        <optgroup label="Neural2 (ìµœì‹  ì‹ ê²½ë§)">
                            <option value="ko-KR-Neural2-A" selected>ì—¬ì„± A (ì¶”ì²œ) ğŸ¤</option>
                            <option value="ko-KR-Neural2-B">ë‚¨ì„± A</option>
                            <option value="ko-KR-Neural2-C">ì—¬ì„± B</option>
                        </optgroup>
                        <optgroup label="Wavenet (ê³ í’ˆì§ˆ)">
                            <option value="ko-KR-Wavenet-A">ì—¬ì„± A</option>
                            <option value="ko-KR-Wavenet-B">ë‚¨ì„± A</option>
                            <option value="ko-KR-Wavenet-C">ì—¬ì„± B</option>
                            <option value="ko-KR-Wavenet-D">ë‚¨ì„± B</option>
                        </optgroup>
                        <optgroup label="Standard (ê¸°ë³¸)">
                            <option value="ko-KR-Standard-A">ì—¬ì„± A</option>
                            <option value="ko-KR-Standard-B">ë‚¨ì„± A</option>
                            <option value="ko-KR-Standard-C">ì—¬ì„± B</option>
                            <option value="ko-KR-Standard-D">ë‚¨ì„± B</option>
                        </optgroup>
                    </select>
                    
                    <p class="text-xs text-slate-500 mt-2">
                        ğŸ’¡ API í‚¤ ë°œê¸‰: <a href="https://console.cloud.google.com/apis/credentials" target="_blank" class="text-blue-400 hover:underline">Google Cloud Console</a>
                        <br>Cloud Text-to-Speech API í™œì„±í™” í•„ìˆ˜!
                    </p>
                </div>

                <!-- ì €ì¥ ë°©ì‹ -->
                <div class="flex items-center justify-between mb-4">
                    <div class="flex flex-col">
                        <span class="text-sm font-semibold">í‚¤ ì €ì¥ ë°©ì‹</span>
                        <span class="text-xs text-slate-400">LocalStorage(ê¸°ë³¸) / SessionStorage(ì„¸ì…˜ë§Œ)</span>
                    </div>
                    <label class="flex items-center gap-3 cursor-pointer">
                        <input type="checkbox" id="key-session-only" class="toggle-checkbox">
                        <span class="toggle-label text-sm">ì„¸ì…˜ë§Œ</span>
                    </label>
                </div>

                <div class="flex justify-end gap-2">
                    <button id="btn-settings-close" class="px-4 py-2 rounded-lg bg-slate-700 hover:bg-slate-600 transition-all">ë‹«ê¸°</button>
                    <button id="btn-save-key" class="px-4 py-2 rounded-lg bg-blue-600 hover:bg-blue-500 transition-all">ì €ì¥</button>
                </div>
            </div>
        </div>

        <!-- ğŸ”— Extend Modal (v10.5 NEW!) -->
        <div id="extend-modal" class="hidden fixed inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm">
            <div class="glass p-6 rounded-2xl w-full max-w-3xl mx-4 max-h-[90vh] overflow-y-auto">
                <div class="flex items-center justify-between mb-4">
                    <h2 class="text-xl font-bold flex items-center gap-2">
                        <i class="fas fa-link text-purple-400"></i> 
                        ê³¡ ì—°ì¥(Extend) ëª¨ë“œ
                    </h2>
                    <button id="btn-extend-close" class="p-2 glass rounded-lg hover:bg-slate-700">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                
                <div class="mb-4 p-3 bg-purple-900/20 rounded-lg border border-purple-500/30">
                    <p class="text-sm text-purple-200">
                        ğŸ’¡ <strong>ì‚¬ìš©ë²•:</strong> ì´ë¯¸ ìƒì„±í•œ 1ì ˆê³¼ í›„ë ´ì„ ì…ë ¥í•˜ë©´, 
                        ë™ì¼í•œ ë¶„ìœ„ê¸°ë¡œ ì´ì–´ì§€ëŠ” 2ì ˆ/Bridgeë¥¼ ìë™ ìƒì„±í•´ì¤˜ìš”!
                    </p>
                </div>
                
                <div class="mb-4">
                    <label class="block text-sm font-semibold mb-2 text-emerald-300">
                        ê¸°ì¡´ Verse 1 (1ì ˆ)
                    </label>
                    <textarea id="extend-verse1" rows="6" 
                        class="w-full p-3 glass rounded-xl focus:ring-2 focus:ring-purple-500 outline-none bg-slate-800 font-mono text-sm"
                        placeholder="[Verse 1]&#10;(Piano-driven, intimate vocal)&#10;ì‹ì–´ë²„ë¦° ë³„~&#10;ë‚¡ì€ ì¡°ê°&#10;íˆ¬ëª…í•œ ê³µê¸°~&#10;ì»¤íŠ¼ì„ ì ì…”"></textarea>
                </div>
                
                <div class="mb-4">
                    <label class="block text-sm font-semibold mb-2 text-blue-300">
                        ê¸°ì¡´ Chorus (í›„ë ´)
                    </label>
                    <textarea id="extend-chorus" rows="6" 
                        class="w-full p-3 glass rounded-xl focus:ring-2 focus:ring-blue-500 outline-none bg-slate-800 font-mono text-sm"
                        placeholder="[Chorus]&#10;(Full instrumentation, warm close harmonies)&#10;ì§€ì²´ëœ ê³„ì ˆ&#10;ë¨¼ì§€ ìŒ“ì¸ ë°© (hold me now)&#10;ì–¼ì–´ë¶™ì€&#10;ë¹ˆ ì˜ì ìœ„ë¡œ&#10;ê·¸ë¦¼ì ì§„ë‹¤"></textarea>
                </div>
                
                <div class="flex gap-2">
                    <button id="btn-extend-generate" class="flex-1 px-4 py-3 rounded-lg bg-purple-600 hover:bg-purple-500 transition-all font-bold">
                        âœ¨ 2ì ˆ/Bridge ìƒì„±í•˜ê¸°
                    </button>
                    <button id="btn-extend-close-2" class="px-4 py-3 rounded-lg bg-slate-700 hover:bg-slate-600 transition-all">
                        ë‹«ê¸°
                    </button>
                </div>
            </div>
        </div>

        <!-- History Modal -->
        <div id="history-modal" class="hidden fixed inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm">
            <div class="glass p-6 rounded-2xl w-full max-w-2xl mx-4 h-[80vh] flex flex-col">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-xl font-bold flex items-center gap-2"><i class="fas fa-archive text-purple-400"></i> ëª…ê³¡ ë³´ê´€í•¨</h2>
                    <button id="btn-history-close" class="text-slate-400 hover:text-white"><i class="fas fa-times fa-lg"></i></button>
                </div>
                <div id="history-list" class="flex-1 overflow-y-auto space-y-4 pr-2">
                    <div class="text-center text-slate-500 py-10">ì•„ì§ ì €ì¥ëœ ëª…ê³¡ì´ ì—†ì–´, ì˜¤ë¹ ! ğŸµ</div>
                </div>
                <div class="mt-4 pt-4 border-t border-slate-700 flex justify-between items-center">
                    <div class="text-[10px] text-slate-500">v9.2: ì´ë²¤íŠ¸ ìœ„ì„ìœ¼ë¡œ ì•ˆì „ì„± ê°•í™”</div>
                    <button id="btn-clear-history" class="text-xs text-red-400 hover:text-red-300 underline">ë³´ê´€í•¨ ë¹„ìš°ê¸°</button>
                </div>
            </div>
        </div>

        <!-- Input Section -->
        <section class="glass p-6 rounded-2xl mb-8 border-t-4 border-emerald-500">
            <!-- ì ‘ê¸°/í¼ì¹˜ê¸° í—¤ë” -->
            <div id="input-header" class="collapse-header flex items-center justify-between mb-6 p-3 rounded-lg">
                <div class="flex items-center gap-3">
                    <i class="fas fa-sliders-h text-emerald-400 text-xl"></i>
                    <h2 class="text-xl font-bold text-emerald-300">ğŸ›ï¸ ê°€ì‚¬ ìƒì„± ì„¤ì •</h2>
                    <span class="text-xs text-slate-400">(í´ë¦­í•˜ë©´ ì ‘í˜/í¼ì¹¨)</span>
                </div>
                <i id="input-collapse-icon" class="fas fa-chevron-up collapse-icon text-emerald-400 text-lg"></i>
            </div>
            
            <!-- ì ‘ì„ ìˆ˜ ìˆëŠ” ë‚´ìš© -->
            <div id="input-content" class="collapsible-section expanded">
            
            <!-- ğŸŒŸ v10.5: ê°„í¸/ê³ ê¸‰ ëª¨ë“œ í† ê¸€ -->
            <div class="mode-toggle">
                <button id="mode-simple" class="mode-btn active">
                    <span>ğŸŒŸ ê°„í¸ ëª¨ë“œ</span>
                    <span style="font-size: 11px; opacity: 0.7;">(3ë‹¨ê³„ë¡œ ì™„ì„±!)</span>
                </button>
                <button id="mode-advanced" class="mode-btn">
                    <span>âš™ï¸ ê³ ê¸‰ ëª¨ë“œ</span>
                    <span style="font-size: 11px; opacity: 0.7;">(ëª¨ë“  ì˜µì…˜)</span>
                </button>
            </div>
            
            <!-- ğŸŒŸ ê°„í¸ ëª¨ë“œ ì½˜í…ì¸  -->
            <div id="simple-mode-content" class="simple-mode active">
                <!-- 1ë‹¨ê³„: ì£¼ì œ ì…ë ¥ -->
                <div class="step">
                    <h3>1ï¸âƒ£ ë¬´ìŠ¨ ì´ì•¼ê¸°ë¥¼ ë‹´ì„ê¹Œìš”?</h3>
                    <p class="step-desc">ê°€ì‚¬ì˜ ì£¼ì œë‚˜ ê°ì •ì„ ììœ ë¡­ê²Œ ì…ë ¥í•´ë³´ì„¸ìš”!</p>
                    <div style="position: relative;">
                        <textarea id="simple-keyword" class="big-input" placeholder="ğŸ’¡ Suno AI ì‚¬ìš© íŒ (ì´ˆë³´ììš©):

ğŸ“ ì£¼ì œë§Œ ì…ë ¥í•˜ë©´ ìë™ìœ¼ë¡œ ê°€ì‚¬ ìƒì„±ë¼!
ì˜ˆ: &quot;ë¹„ ì˜¤ëŠ” ì§‘&quot;, &quot;ë– ë‚œ ì„&quot;, &quot;ë°˜ì§ì´ëŠ” ë°¤&quot;

ğŸµ ìŒí–¥íš¨ê³¼ëŠ” ìë™ ì¶”ê°€ë˜ë‹ˆê¹Œ ì‹ ê²½ ì“°ì§€ ë§ˆ!
ğŸ¯ êµ¬ì¡° íƒœê·¸([Intro], [Verse])ë„ ìë™!

ğŸ’¡ ì¥ë¥´ë³„ í‚¤ì›Œë“œ ì˜ˆì‹œ:
ğŸ’” ë°œë¼ë“œ â†’ ìŠ¬í”ˆ ê°ì • (ë¹„, ì´ë³„, ì¶”ì–µ, ê·¸ë¦¬ì›€)
ğŸº íŠ¸ë¡œíŠ¸ â†’ í•œêµ­ì  ì •ì„œ (ì„, ëˆˆë¬¼, í•­êµ¬, ê³ í–¥)  
ğŸ’ƒ K-Pop â†’ ì—ë„ˆì§€ ë„˜ì¹˜ëŠ” (ë¹›, ì¶¤, íŒŒí‹°, ê¿ˆ)
ğŸ•º Funk â†’ ìì‹ ê° (ê·¸ë£¨ë¸Œ, ë¦¬ë“¬, ìŠ¤íƒ€ì¼, ììœ )
ğŸ§ Lo-fi â†’ ì¡°ìš©í•œ ê°ì„± (í˜¼ì, ë°¤, ì»¤í”¼, ë¹—ì†Œë¦¬)

âš ï¸ ì£¼ì˜: ë„ˆë¬´ ê¸¸ê²Œ ì“°ë©´ ì•ˆ ë¼! ì§§ì€ í‚¤ì›Œë“œë§Œ!
âœ… ì¢‹ì€ ì˜ˆ: &quot;ë‚¡ì€ ë‹¤ì´ì–´ë¦¬&quot;
âŒ ë‚˜ìœ ì˜ˆ: &quot;ë¹„ ì˜¤ëŠ” ë‚  í—¤ì–´ì§„ ì—°ì¸ì„ ìƒê°í•˜ë©° í˜¼ì ë‚¨ê²¨ì§„ ë‚˜ì˜ ì™¸ë¡œìš´ ë§ˆìŒ&quot;" style="padding-right: 60px;"></textarea>
                        <button id="simple-random-keyword" class="p-3 glass rounded-lg hover:bg-emerald-600/50 text-emerald-300 transition-all" style="position: absolute; right: 12px; top: 12px;" title="ëœë¤ ì˜ê°">
                            <i class="fas fa-dice text-xl"></i>
                        </button>
                    </div>
                </div>
                
                <!-- 2ë‹¨ê³„: ì¥ë¥´ ì„ íƒ -->
                <div class="step">
                    <h3>2ï¸âƒ£ ì–´ë–¤ ëŠë‚Œì˜ ê³¡ì¸ê°€ìš”?</h3>
                    <p class="step-desc">ë§ˆìŒì— ë“œëŠ” ì¥ë¥´ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”!</p>
                    <div class="genre-grid">
                        <button class="genre-card" data-genre="pop80s">
                            <span class="icon">ğŸ’”</span>
                            <span class="label">ê°ì„± ë°œë¼ë“œ</span>
                            <span class="desc">ì• ì ˆí•˜ê³  ê°ì„±ì ì¸</span>
                        </button>
                        <button class="genre-card" data-genre="trot">
                            <span class="icon">ğŸº</span>
                            <span class="label">íŠ¸ë¡œíŠ¸</span>
                            <span class="desc">í•œêµ­ì  ì •ì„œì˜</span>
                        </button>
                        <button class="genre-card" data-genre="kpop_dance">
                            <span class="icon">ğŸ’ƒ</span>
                            <span class="label">K-Pop ëŒ„ìŠ¤</span>
                            <span class="desc">ê²½ì¾Œí•˜ê³  ì‹ ë‚˜ëŠ”</span>
                        </button>
                        <button class="genre-card" data-genre="lofi_hiphop">
                            <span class="icon">ğŸ§</span>
                            <span class="label">ë¡œíŒŒì´ í™í•©</span>
                            <span class="desc">í¸ì•ˆí•˜ê³  íë§ë˜ëŠ”</span>
                        </button>
                        <button class="genre-card" data-genre="funk_pop">
                            <span class="icon">ğŸ•º</span>
                            <span class="label">Funk Pop</span>
                            <span class="desc">ì‹ ë‚˜ê³  ê·¸ë£¨ë¹„í•œ</span>
                        </button>
                        <button class="genre-card" data-genre="indie_pop">
                            <span class="icon">ğŸ¸</span>
                            <span class="label">Indie Pop</span>
                            <span class="desc">ì§„ì†”í•˜ê³  ê°ì„±ì ì¸</span>
                        </button>
                    </div>
                </div>
                
                <!-- 3ë‹¨ê³„: ìƒì„± ì˜µì…˜ ì„ íƒ -->
                <div class="step">
                    <h3>3ï¸âƒ£ ë¬´ì—‡ì„ ë§Œë“¤ê¹Œìš”?</h3>
                    <p class="step-desc">í•„ìš”í•œ ê²ƒë§Œ ì„ íƒí•˜ë©´ ë¹ ë¥´ê³  ì €ë ´í•´ìš”! (ê°€ì‚¬ëŠ” í•„ìˆ˜)</p>
                    <div class="grid grid-cols-2 md:grid-cols-3 gap-3">
                        <label class="flex items-center gap-3 p-3 glass rounded-lg cursor-not-allowed opacity-60">
                            <input type="checkbox" id="simple-opt-lyrics" checked disabled class="toggle-checkbox w-5 h-5">
                            <span class="text-sm font-semibold">
                                <i class="fas fa-file-alt text-blue-400"></i> ê°€ì‚¬ <span class="text-xs text-slate-500">(í•„ìˆ˜)</span>
                            </span>
                        </label>
                        <label class="flex items-center gap-3 p-3 glass rounded-lg cursor-pointer hover:bg-slate-700/50 transition-all">
                            <input type="checkbox" id="simple-opt-marketing" class="toggle-checkbox w-5 h-5">
                            <span class="text-sm font-semibold">
                                <i class="fas fa-bullhorn text-violet-400"></i> SNS ë§ˆì¼€íŒ…
                            </span>
                        </label>
                        <label class="flex items-center gap-3 p-3 glass rounded-lg cursor-pointer hover:bg-slate-700/50 transition-all">
                            <input type="checkbox" id="simple-opt-video" class="toggle-checkbox w-5 h-5">
                            <span class="text-sm font-semibold">
                                <i class="fas fa-video text-rose-400"></i> ì˜ìƒ ìŠ¤í¬ë¦½íŠ¸
                            </span>
                        </label>
                        <label class="flex items-center gap-3 p-3 glass rounded-lg cursor-pointer hover:bg-slate-700/50 transition-all">
                            <input type="checkbox" id="simple-opt-art" class="toggle-checkbox w-5 h-5">
                            <span class="text-sm font-semibold">
                                <i class="fas fa-image text-yellow-400"></i> ì•¨ë²” ì•„íŠ¸
                            </span>
                        </label>
                        <label class="flex items-center gap-3 p-3 glass rounded-lg cursor-pointer hover:bg-slate-700/50 transition-all">
                            <input type="checkbox" id="simple-opt-translation" class="toggle-checkbox w-5 h-5">
                            <span class="text-sm font-semibold">
                                <i class="fas fa-globe text-green-400"></i> ê¸€ë¡œë²Œ ë²ˆì—­
                            </span>
                        </label>
                        <label class="flex items-center gap-3 p-3 glass rounded-lg cursor-pointer hover:bg-slate-700/50 transition-all">
                            <input type="checkbox" id="simple-opt-chorus-variation" checked class="toggle-checkbox w-5 h-5">
                            <span class="text-sm font-semibold">
                                <i class="fas fa-sync-alt text-cyan-400"></i> ì½”ëŸ¬ìŠ¤ ë³€ì£¼
                            </span>
                        </label>
                    </div>
                </div>
                
                <!-- 4ë‹¨ê³„: ìƒì„± ë²„íŠ¼ -->
                <div class="step">
                    <h3>4ï¸âƒ£ ì¤€ë¹„ ì™„ë£Œ!</h3>
                    <button id="simple-generate-btn" class="mega-button">
                        <span>âš¡ ê°€ì‚¬ ìƒì„±í•˜ê¸°!</span>
                        <span class="sub">3ì´ˆë©´ ì™„ì„±ë¼ìš” ğŸ˜Š</span>
                    </button>
                </div>
            </div>
            
            <!-- âš™ï¸ ê³ ê¸‰ ëª¨ë“œ ì½˜í…ì¸  -->
            <div id="advanced-mode-content" class="advanced-mode">
            
            <!-- ğŸ”¥ v10.5: ëª¨ë“œ íƒ­ (ì¼ë°˜ ìƒì„± / ê³¡ ì—°ì¥) -->
            <div id="mode-tabs" class="flex gap-2 mb-6">
                <button id="tab-normal" class="tab-button active flex-1 p-3 rounded-xl font-bold transition-all flex items-center justify-center gap-2">
                    <i class="fas fa-music"></i>
                    <span>ğŸ“ ì¼ë°˜ ìƒì„±</span>
                </button>
                <button id="tab-extend" class="tab-button flex-1 p-3 rounded-xl font-bold transition-all flex items-center justify-center gap-2">
                    <i class="fas fa-link"></i>
                    <span>ğŸ”— ê³¡ ì—°ì¥(Extend)</span>
                    <span class="badge badge-gemini3 text-xs ml-1">NEW!</span>
                </button>
            </div>
            
            <!-- ì ‘ì„ ìˆ˜ ìˆëŠ” ë‚´ìš© -->
            <div id="input-content" class="collapsible-section expanded">
            
            <!-- ğŸ“ ì¼ë°˜ ìƒì„± ëª¨ë“œ ì½˜í…ì¸  -->
            <div id="normal-mode-content" class="tab-content active">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-6">
                <div>
                    <label class="block text-sm font-semibold mb-2 text-emerald-300">ì£¼ ì¥ë¥´ <span class="text-xs bg-emerald-900/50 px-2 py-0.5 rounded">v11.0 - 17ì¢…! ğŸŒ</span></label>
                    <select id="genre" class="w-full p-3 glass rounded-xl focus:ring-2 focus:ring-emerald-500 outline-none cursor-pointer bg-slate-800">
                        <optgroup label="ğŸ’ ê°ì„± ì¥ì¸ íŒ© (í”„ë¦¬ë¯¸ì—„ ë°œë¼ë“œ)">
                            <option value="pop80s" selected>80s ë©œë¡œë”• íŒ ë°œë¼ë“œ</option>
                            <option value="trot">ì •í†µ íŠ¸ë¡œíŠ¸ ë°œë¼ë“œ</option>
                            <option value="ballad">í•œêµ­í˜• ê°ì„± ë°œë¼ë“œ</option>
                            <option value="acoustic_folk">ì–´ì¿ ìŠ¤í‹± í¬í¬ (íë§)</option>
                            <option value="rock_ballad">ë¡ ë°œë¼ë“œ (ê³ ìŒ í­ë°œ)</option>
                            <option value="rnb">í•œêµ­í˜• R&B ë°œë¼ë“œ</option>
                        </optgroup>
                        <optgroup label="ğŸµ MZ ì‡¼ì¸  íŒ© (íŠ¸ë Œë””)">
                            <option value="kpop_dance">K-Pop ì•„ì´ëŒ ëŒ„ìŠ¤</option>
                            <option value="city_pop">ì‹œí‹° íŒ (K-Retro)</option>
                            <option value="lofi_hiphop">ë¡œíŒŒì´ í™í•© (ê³µë¶€ìš©)</option>
                        </optgroup>
                        <optgroup label="ğŸŒŸ ìŠ¤í˜ì…œ ì—ë””ì…˜">
                            <option value="europop">ABBA ìŠ¤íƒ€ì¼ ìœ ë¡œíŒ</option>
                            <option value="metal">ì‹¬í¬ë‹‰/ê³ ë”• ë©”íƒˆ</option>
                        </optgroup>
                        <optgroup label="ğŸŒ ê¸€ë¡œë²Œ íˆíŠ¸ íŒ© (NEW!)">
                            <option value="hip_hop_boom_bap">Hip-Hop Boom Bap (90s)</option>
                            <option value="trap_melodic">Melodic Trap (ê°ì„± ë˜í•‘)</option>
                            <option value="funk_pop">Funk Pop (ë¸Œë£¨ë…¸ ë§ˆìŠ¤)</option>
                            <option value="reggaeton">Reggaeton (ë¼í‹´ ëŒ„ìŠ¤)</option>
                            <option value="future_bass">Future Bass (EDM íŒ)</option>
                            <option value="indie_pop">Indie Pop (Bedroom Pop)</option>
                        </optgroup>
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-semibold mb-2 text-fuchsia-300 flex items-center gap-2">
                        <i class="fas fa-magic"></i> ì¥ë¥´ ìœµí•© <span class="text-[10px] bg-fuchsia-900/50 px-2 py-0.5 rounded">v8.0</span>
                    </label>
                    <select id="genre-fusion" class="w-full p-3 glass rounded-xl focus:ring-2 focus:ring-fuchsia-500 outline-none cursor-pointer bg-slate-800">
                        <option value="">ìœµí•© ì•ˆí•¨</option>
                        <option value="jazz">+ ì¬ì¦ˆ</option>
                        <option value="rock">+ ë¡</option>
                        <option value="electronic">+ ì¼ë ‰íŠ¸ë¡œë‹‰</option>
                        <option value="classical">+ í´ë˜ì‹œì»¬</option>
                        <option value="hiphop">+ í™í•©</option>
                        <option value="folk">+ í¬í¬</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-semibold mb-2 text-purple-300 flex items-center gap-2">
                        <i class="fas fa-microphone-alt"></i> ë³´ì»¬ ì»¬ëŸ¬
                    </label>
                    <select id="vocal-color" class="w-full p-3 glass rounded-xl focus:ring-2 focus:ring-purple-500 outline-none cursor-pointer bg-slate-800">
                        <option value="default">ê¸°ë³¸</option>
                        <option value="husky">í—ˆìŠ¤í‚¤í•œ</option>
                        <option value="clear">ì²­ì•„í•œ</option>
                        <option value="powerful">íŒŒì›Œí’€í•œ</option>
                        <option value="whispery">ì†ì‚­ì´ëŠ”</option>
                        <option value="smooth">ê°ë¯¸ë¡œìš´</option>
                        <option value="emotional">ì ˆì ˆí•œ</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-semibold mb-2 text-blue-300 flex items-center gap-2">
                        <i class="fas fa-layer-group"></i> ê³¡ êµ¬ì¡°
                    </label>
                    <select id="structure" class="w-full p-3 glass rounded-xl focus:ring-2 focus:ring-blue-500 outline-none cursor-pointer bg-slate-800">
                        <option value="standard" selected>í‘œì¤€ (3:40)</option>
                        <option value="short">ê°„ê²° (2:30)</option>
                        <option value="extended">ì›…ì¥ (4:30)</option>
                    </select>
                </div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                <!-- ë³´ì»¬ êµ¬ì„± (í”Œë ˆì´ìŠ¤í™€ë” ìŠ¤íƒ€ì¼) -->
                <div class="glass p-3 rounded-xl bg-slate-800/50 border border-pink-500/30 flex items-center gap-3">
                    <span class="text-sm font-semibold text-pink-300 flex items-center gap-2 whitespace-nowrap">
                        <i class="fas fa-users"></i> ë³´ì»¬êµ¬ì„±
                    </span>
                    <div class="flex gap-4 flex-1">
                        <label class="flex items-center gap-2 cursor-pointer"><input type="radio" name="vocal-config" value="solo" checked class="w-4 h-4 text-pink-500"><span class="text-sm">Solo</span></label>
                        <label class="flex items-center gap-2 cursor-pointer"><input type="radio" name="vocal-config" value="duet" class="w-4 h-4 text-pink-500"><span class="text-sm">Duet</span></label>
                        <label class="flex items-center gap-2 cursor-pointer"><input type="radio" name="vocal-config" value="group" class="w-4 h-4 text-pink-500"><span class="text-sm">Group</span></label>
                    </div>
                </div>
                
                <!-- ê°ì • ê°•ë„ (í”Œë ˆì´ìŠ¤í™€ë” ìŠ¤íƒ€ì¼) -->
                <div class="glass p-3 rounded-xl bg-slate-800/50 border border-amber-500/30 flex items-center gap-3">
                    <span class="text-sm font-semibold text-amber-300 flex items-center gap-2 whitespace-nowrap">
                        <i class="fas fa-heart"></i> ê°ì •ê°•ë„
                    </span>
                    <div class="flex items-center gap-3 flex-1">
                        <span class="text-xs text-slate-400">ì€ì€</span>
                        <input type="range" id="emotion-intensity" min="0" max="100" value="70" class="flex-1 h-2 bg-slate-700 rounded-lg appearance-none cursor-pointer accent-amber-500">
                        <span class="text-xs text-slate-400">ê²©ë ¬</span>
                        <span id="emotion-value" class="text-sm font-bold text-amber-300 w-12 text-center">70%</span>
                    </div>
                </div>
            </div>

            <!-- í”„ë¦¬ì…‹ & í‚¤ì›Œë“œ (í”Œë ˆì´ìŠ¤í™€ë” ìŠ¤íƒ€ì¼) -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                <!-- í”„ë¦¬ì…‹ ì €ì¥ì†Œ (ì™„ì „ ì••ì¶•!) -->
                <div class="glass p-3 rounded-xl bg-slate-800/50 border border-indigo-500/30 flex items-center gap-2">
                    <select id="preset-selector" class="flex-1 p-2 text-sm glass rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none cursor-pointer bg-slate-800">
                        <option value="">ğŸ’¾ í”„ë¦¬ì…‹ ì„ íƒ...</option>
                    </select>
                    <button id="btn-save-preset" class="p-2 glass rounded-lg hover:bg-indigo-600/50 text-indigo-300 transition-all" title="í”„ë¦¬ì…‹ ì €ì¥"><i class="fas fa-save"></i></button>
                    <button id="btn-delete-preset" class="p-2 glass rounded-lg hover:bg-red-600/50 text-red-300 transition-all" title="í”„ë¦¬ì…‹ ì‚­ì œ"><i class="fas fa-trash"></i></button>
                </div>

                <!-- ê³¡ì˜ ì£¼ì œ/í‚¤ì›Œë“œ (í”Œë ˆì´ìŠ¤í™€ë” ìŠ¤íƒ€ì¼) -->
                <div class="glass p-3 rounded-xl bg-slate-800/50 border border-emerald-500/30 flex items-center gap-2">
                    <input id="keyword" type="text" placeholder="ğŸ’¡ íŒ: ì§§ì€ í‚¤ì›Œë“œë§Œ! ì˜ˆ: "ë¹„ ì˜¤ëŠ” ì§‘", "ë– ë‚œ ì„", "ë°˜ì§ì´ëŠ” ë°¤" | âš ï¸ ë¬¸ì¥ í˜•íƒœë¡œ ê¸¸ê²Œ ì“°ì§€ ë§ˆì„¸ìš”! | ğŸµ ìŒí–¥íš¨ê³¼ëŠ” ìƒì„±ëœ ê°€ì‚¬ì— ìë™ ì¶”ê°€ë¨" class="flex-1 p-0 bg-transparent focus:ring-0 outline-none text-sm">
                    <button id="btn-random-keyword" class="p-2 glass rounded-lg hover:bg-emerald-600/50 text-emerald-300 transition-all" title="ëœë¤ ì˜ê°"><i class="fas fa-dice"></i></button>
                </div>
            </div>

            <!-- ê°ì • & ë””ë ‰íŒ… ì„¤ì • (í†µí•© & ì ‘ê¸°) -->
            <div class="glass p-4 rounded-xl mb-6 bg-slate-800/50 border border-violet-500/30">
                <!-- ì ‘ê¸°/í¼ì¹˜ê¸° í—¤ë” -->
                <div id="emotion-header" class="collapse-header flex items-center justify-between p-2 rounded-lg">
                    <div class="flex items-center gap-2">
                        <i class="fas fa-heart text-violet-400"></i>
                        <h3 class="text-sm font-bold text-violet-300">ğŸ­ ê°ì • & ë””ë ‰íŒ… ì„¤ì •</h3>
                        <span class="text-[10px] bg-violet-900/50 px-2 py-0.5 rounded">ê³ ê¸‰ ì˜µì…˜</span>
                        <span class="text-xs text-slate-400">(í´ë¦­í•˜ë©´ ì ‘í˜/í¼ì¹¨)</span>
                    </div>
                    <i id="emotion-collapse-icon" class="fas fa-chevron-down collapse-icon rotated text-violet-400"></i>
                </div>
                
                <!-- ì ‘ì„ ìˆ˜ ìˆëŠ” ë‚´ìš© (ê¸°ë³¸: ì ‘íŒ ìƒíƒœ) -->
<div id="emotion-content" class="collapsible-section collapsed">
                    <!-- ê°ì • í†¤ 4ê°œ (í”Œë ˆì´ìŠ¤í™€ë” ìŠ¤íƒ€ì¼) -->
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-3 mt-4 mb-4">
                        <select id="mood-tone" class="w-full p-2.5 text-sm glass rounded-lg focus:ring-2 focus:ring-orange-500 outline-none cursor-pointer bg-slate-800">
                            <option value="">ğŸ¨ ê°ì •í†¤: ê¸°ë³¸</option>
                            <option value="bittersweet-hope">ğŸ˜” ì”ì“¸í•œ í¬ë§</option>
                            <option value="grand-darkness">âš« ì›…ì¥í•œ ì–´ë‘ </option>
                            <option value="quiet-despair">ğŸŒ«ï¸ ì¡°ìš©í•œ ì ˆë§</option>
                            <option value="nostalgic-warmth">ğŸŒ… ê·¸ë¦¬ìš´ ì˜¨ê¸°</option>
                            <option value="epic-tragedy">ğŸ’” ì„œì‚¬ì  ë¹„ê·¹</option>
                        </select>
                        <select id="mood-season" class="w-full p-2.5 text-sm glass rounded-lg focus:ring-2 focus:ring-pink-500 outline-none cursor-pointer bg-slate-800">
                            <option value="">ğŸŒ™ ê³„ì ˆ: ê¸°ë³¸</option>
                            <option value="winter-night">â„ï¸ ê²¨ìš¸ë°¤</option>
                            <option value="autumn-sunset">ğŸ‚ ê°€ì„ ì„ì–‘</option>
                            <option value="rainy-dawn">ğŸŒ§ï¸ ë¹„ ì˜¤ëŠ” ìƒˆë²½</option>
                            <option value="spring-dusk">ğŸŒ¸ ë´„ í™©í˜¼</option>
                            <option value="summer-storm">â›ˆï¸ ì—¬ë¦„ í­í’</option>
                        </select>
                        <select id="mood-place" class="w-full p-2.5 text-sm glass rounded-lg focus:ring-2 focus:ring-cyan-500 outline-none cursor-pointer bg-slate-800">
                            <option value="">ğŸ“ ì¥ì†Œ: ê¸°ë³¸</option>
                            <option value="empty-station">ğŸš‰ í…… ë¹ˆ ì—­</option>
                            <option value="old-cafe">â˜• ì˜¤ë˜ëœ ì¹´í˜</option>
                            <option value="rain-window">ğŸªŸ ë¹—ë°©ìš¸ ì°½ë¬¸</option>
                            <option value="night-street">ğŸŒƒ ë°¤ê±°ë¦¬</option>
                            <option value="ocean-pier">âš“ ë°”ë‹¤ ë¶€ë‘</option>
                        </select>
                        <select id="mood-psychology" class="w-full p-2.5 text-sm glass rounded-lg focus:ring-2 focus:ring-amber-500 outline-none cursor-pointer bg-slate-800">
                            <option value="">ğŸ§  ì‹¬ë¦¬: ê¸°ë³¸</option>
                            <option value="denial">ğŸ™… ë¶€ì •í•˜ëŠ” ì¤‘</option>
                            <option value="acceptance">ğŸ¤ ë°›ì•„ë“¤ì´ëŠ” ì¤‘</option>
                            <option value="regret">ğŸ˜¢ í›„íšŒí•˜ëŠ” ì¤‘</option>
                            <option value="longing">ğŸ’­ ê·¸ë¦¬ì›Œí•˜ëŠ” ì¤‘</option>
                            <option value="numbness">ğŸ˜¶ ë¬´ê°ê°í•œ ìƒíƒœ</option>
                        </select>
                    </div>

            <div class="border-t border-slate-700 pt-4 mt-4">
                <div class="flex items-center justify-between mb-3">
                    <h3 class="text-sm font-bold text-indigo-300 flex items-center gap-2"><i class="fas fa-film"></i> ì„¹ì…˜ë³„ ê°ì • ë””ë ‰íŒ…</h3>
                    <button id="btn-toggle-section" class="text-xs px-2 py-1 glass rounded hover:bg-indigo-600/50 transition-all"><i id="section-toggle-icon" class="fas fa-chevron-down"></i></button>
                </div>
                <!-- ì„¹ì…˜ë³„ ë””ë ‰íŒ… (í”Œë ˆì´ìŠ¤í™€ë” ìŠ¤íƒ€ì¼) -->
                <div id="section-directing-panel" class="hidden grid grid-cols-2 md:grid-cols-3 gap-3 mt-3">
                    <select id="section-verse" class="w-full p-2 text-xs glass rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none bg-slate-800">
                        <option value="">ğŸ“ Verse: ê¸°ë³¸</option>
                        <option value="whispery">ğŸ¤« ì†ì‚­ì´ë“¯</option>
                        <option value="intimate">ğŸ’• ì¹œë°€í•˜ê²Œ</option>
                        <option value="storytelling">ğŸ“– ì´ì•¼ê¸°í•˜ë“¯</option>
                        <option value="melancholic">ğŸ˜” ìš°ìš¸í•˜ê²Œ</option>
                    </select>
                    <select id="section-prechorus" class="w-full p-2 text-xs glass rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none bg-slate-800">
                        <option value="">ğŸ“Š Pre-Chorus: ê¸°ë³¸</option>
                        <option value="building">ğŸ“ˆ ì ì  ê³ ì¡°</option>
                        <option value="anticipation">âœ¨ ê¸°ëŒ€ê°</option>
                        <option value="tension">âš¡ ê¸´ì¥ê°</option>
                        <option value="hopeful">ğŸŒŸ í¬ë§ì </option>
                    </select>
                    <select id="section-chorus" class="w-full p-2 text-xs glass rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none bg-slate-800">
                        <option value="">ğŸµ Chorus: ê¸°ë³¸</option>
                        <option value="powerful">ğŸ’ª íŒŒì›Œí’€í•˜ê²Œ</option>
                        <option value="emotional">ğŸ’— ê°ì •ì ìœ¼ë¡œ</option>
                        <option value="cathartic">ğŸŒŠ ì¹´íƒ€ë¥´ì‹œìŠ¤</option>
                        <option value="triumphant">ğŸ† ìŠ¹ë¦¬ê°</option>
                    </select>
                    <select id="section-bridge" class="w-full p-2 text-xs glass rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none bg-slate-800">
                        <option value="">ğŸŒ‰ Bridge: ê¸°ë³¸</option>
                        <option value="vulnerable">ğŸ¥€ ì—°ì•½í•˜ê²Œ</option>
                        <option value="reflective">ğŸ’­ íšŒìƒí•˜ë“¯</option>
                        <option value="desperate">ğŸ˜° ì ˆë°•í•˜ê²Œ</option>
                        <option value="resigned">ğŸ˜” ì²´ë…í•˜ë“¯</option>
                    </select>
                    <select id="section-final" class="w-full p-2 text-xs glass rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none bg-slate-800">
                        <option value="">ğŸ­ Final: ê¸°ë³¸</option>
                        <option value="climax">ğŸ”¥ ìµœê³ ì¡°</option>
                        <option value="intense">âš¡ ê°•ë ¬í•˜ê²Œ</option>
                        <option value="liberating">ğŸ•Šï¸ í•´ë°©ê°</option>
                        <option value="bittersweet">ğŸ¯ ì”ì“¸ë‹¬ì½¤</option>
                    </select>
                    <select id="section-outro" class="w-full p-2 text-xs glass rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none bg-slate-800">
                        <option value="">ğŸ¬ Outro: ê¸°ë³¸</option>
                        <option value="fading">ğŸŒ«ï¸ ì ì  í¬ë¯¸</option>
                        <option value="peaceful">ğŸ•Šï¸ í‰í™”ë¡­ê²Œ</option>
                        <option value="unresolved">â“ ë¯¸í•´ê²°</option>
                        <option value="nostalgic">ğŸ’« ê·¸ë¦¬ì›€</option>
                    </select>
                </div>
                <p class="text-xs text-slate-500 mt-2">ğŸ’¡ Tip: ì„¹ì…˜ë³„ ì§€ì‹œëŠ” "ë©œë¡œë”” ë³€í™”" ì²´ê°ì´ í™• ì˜¬ë¼ê°€.</p>
            </div>
                </div><!-- End of emotion-content -->
            </div><!-- End of emotion section -->

            <div class="glass p-4 rounded-xl mb-6 bg-slate-800/50 border border-emerald-500/30">
                <h3 class="text-sm font-bold mb-3 text-emerald-300 flex items-center gap-2"><i class="fas fa-sliders-h"></i> ìƒì„± ì˜µì…˜ ì„ íƒ (ë¹„ìš© ì ˆê° ğŸ’°)</h3>
                <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4">
                    <label class="flex items-center gap-3 cursor-not-allowed opacity-60"><input type="checkbox" id="opt-lyrics" checked disabled class="toggle-checkbox"><span class="toggle-label text-sm"><i class="fas fa-file-alt text-blue-400"></i> ê°€ì‚¬ <span class="text-xs text-slate-500">(í•„ìˆ˜)</span></span></label>
                    <label class="flex items-center gap-3 cursor-pointer"><input type="checkbox" id="opt-marketing" checked class="toggle-checkbox"><span class="toggle-label text-sm"><i class="fas fa-bullhorn text-violet-400"></i> SNS ë§ˆì¼€íŒ…</span></label>
                    <label class="flex items-center gap-3 cursor-pointer"><input type="checkbox" id="opt-video" class="toggle-checkbox"><span class="toggle-label text-sm"><i class="fas fa-video text-rose-400"></i> Veo ì˜ìƒ</span></label>
                    <label class="flex items-center gap-3 cursor-pointer"><input type="checkbox" id="opt-art" class="toggle-checkbox"><span class="toggle-label text-sm"><i class="fas fa-image text-yellow-400"></i> ì•¨ë²” ì•„íŠ¸</span></label>
                    <label class="flex items-center gap-3 cursor-pointer"><input type="checkbox" id="opt-translation" class="toggle-checkbox"><span class="toggle-label text-sm"><i class="fas fa-globe text-green-400"></i> ê¸€ë¡œë²Œ ë²ˆì—­</span></label>
                    <label class="flex items-center gap-3 cursor-pointer"><input type="checkbox" id="opt-chorus-variation" checked class="toggle-checkbox"><span class="toggle-label text-sm"><i class="fas fa-sync-alt text-cyan-400"></i> ì½”ëŸ¬ìŠ¤ ë³€ì£¼</span></label>
                </div>
                <p class="text-xs text-slate-500 mt-3">ğŸ’¡ íŒ: í•„ìš”í•œ í•­ëª©ë§Œ ì²´í¬! API í˜¸ì¶œ ì¤„ì—¬ì„œ ë¹ ë¥´ê³  ì €ë ´í•˜ê²Œ.</p>
            </div>
            </div><!-- End of ì¼ë°˜ ìƒì„± ëª¨ë“œ -->

            <!-- ğŸ”— ê³¡ ì—°ì¥(Extend) ëª¨ë“œ ì½˜í…ì¸  -->
            <div id="extend-mode-content" class="tab-content hidden">
                <div class="mb-4 p-4 bg-purple-900/20 rounded-lg border border-purple-500/30">
                    <p class="text-sm text-purple-200 mb-2">
                        ğŸ’¡ <strong>ê³¡ ì—°ì¥ ëª¨ë“œë€?</strong>
                    </p>
                    <p class="text-xs text-purple-300">
                        ì´ë¯¸ ìƒì„±í•œ 1ì ˆê³¼ í›„ë ´ì„ ì…ë ¥í•˜ë©´, ë™ì¼í•œ ë¶„ìœ„ê¸°ë¡œ ìì—°ìŠ¤ëŸ½ê²Œ ì´ì–´ì§€ëŠ” 
                        <strong>2ì ˆ, Pre-Chorus, Chorus(ë³€ì£¼), Bridge</strong>ë¥¼ ìë™ ìƒì„±í•´ì¤˜ìš”!
                    </p>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                    <div>
                        <label class="block text-sm font-semibold mb-2 text-emerald-300">
                            ê¸°ì¡´ Verse 1 (1ì ˆ) <span class="text-xs text-slate-400">- í•„ìˆ˜</span>
                        </label>
                        <textarea id="extend-verse1-inline" rows="8" 
                            class="w-full p-3 glass rounded-xl focus:ring-2 focus:ring-purple-500 outline-none bg-slate-800 font-mono text-sm"
                            placeholder="[Verse 1]&#10;(Piano-driven, intimate vocal)&#10;ë‚¡ì€ ì˜ì~&#10;ë¨¼ì§€ ìŒ“ì¸ ë°©&#10;íë¦¿í•œ ì°½ë¬¸&#10;ë„¤ ê·¸ë¦¼ì&#10;&#10;ğŸ’¡ íŒ: ì´ë¯¸ ìƒì„±í•œ 1ì ˆì„ ê·¸ëŒ€ë¡œ ë³µì‚¬í•˜ì„¸ìš”!&#10;ì§€ì‹œì–´ (Piano-driven)ë„ í•¨ê»˜ í¬í•¨í•´ì£¼ì„¸ìš”."></textarea>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-semibold mb-2 text-blue-300">
                            ê¸°ì¡´ Chorus (í›„ë ´) <span class="text-xs text-slate-400">- í•„ìˆ˜</span>
                        </label>
                        <textarea id="extend-chorus-inline" rows="8" 
                            class="w-full p-3 glass rounded-xl focus:ring-2 focus:ring-blue-500 outline-none bg-slate-800 font-mono text-sm"
                            placeholder="[Chorus]&#10;(Full instrumentation, warm close harmonies)&#10;ë¹„ ë‚´ë¦¬ëŠ” ì§‘&#10;í˜¼ì ë‚¨ì€ ë°¤ (hold me now)&#10;ì –ì€ ìœ ë¦¬ì°½&#10;ë„¤ ì–¼êµ´ ë²ˆì ¸&#10;&#10;ğŸ’¡ íŒ: í›„ë ´êµ¬ ì „ì²´ë¥¼ ë³µì‚¬í•˜ì„¸ìš”!&#10;í™”ìŒ ì§€ì‹œì–´ì™€ ëŒ€ìœ„ë²•ë„ í¬í•¨í•´ì£¼ì„¸ìš”."></textarea>
                    </div>
                </div>

                <div class="p-3 bg-yellow-900/20 rounded-lg border border-yellow-500/30 mb-4">
                    <p class="text-xs text-yellow-200">
                        âš™ï¸ <strong>ìë™ ìƒì„±ë˜ëŠ” ë‚´ìš©:</strong> Verse 2 (4ì¤„), Pre-Chorus (2ì¤„), Chorus ë³€ì£¼ (ì•µì»¤ 1ì¤„ + ìƒˆë¡œìš´ ì´ë¯¸ì§€), Bridge (4ì¤„)
                    </p>
                </div>
            </div><!-- End of ê³¡ ì—°ì¥ ëª¨ë“œ -->

            <!-- ğŸ¯ í†µí•© ìƒì„± ë²„íŠ¼ (ëª¨ë“  ëª¨ë“œ ê³µí†µ) -->
            <div class="mt-6">
                <button id="generate-btn" class="w-full py-4 bg-gradient-to-r from-emerald-600 via-teal-600 to-blue-600 rounded-xl font-bold text-lg hover:shadow-lg hover:shadow-emerald-500/20 active:scale-[0.98] transition-all relative overflow-hidden group">
                    <span class="relative z-10"><i class="fas fa-bolt mr-2"></i> <span id="generate-btn-text">ì„ íƒí•œ í•­ëª© ìƒì„±í•˜ê¸°</span></span>
                    <div class="absolute inset-0 bg-white/20 translate-y-full group-hover:translate-y-0 transition-transform duration-300"></div>
                </button>
                <button id="cancel-btn" class="hidden w-full py-4 mt-3 bg-slate-800 hover:bg-slate-700 rounded-xl font-bold text-lg border border-slate-600 active:scale-[0.98] transition-all">
                    <i class="fas fa-ban mr-2"></i> ìƒì„± ì·¨ì†Œ
                </button>
            </div>

            </div><!-- End of ê³ ê¸‰ ëª¨ë“œ -->

            </div><!-- End of input-content -->
        </section>
        <!-- Output Section -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            <div class="lg:col-span-2 glass p-6 rounded-2xl border-l-4 border-blue-500 relative">
                <div class="flex justify-between items-center mb-3">
                    <h3 class="text-lg font-bold flex items-center gap-2">
                        <i class="fas fa-file-alt text-blue-400"></i> Suno AI ì „ìš© ê°€ì‚¬
                        <button id="ab-toggle-btn" class="ml-2 px-3 py-1 text-xs glass rounded-lg hover:bg-indigo-600/50 transition-all"><i class="fas fa-columns mr-1"></i> A/B ë¹„êµ</button>
                    </h3>
                    <div class="flex gap-2">
                        <button id="tts-btn" class="p-2.5 glass rounded-lg hover:bg-purple-700 transition-all group" title="AI ì˜¤ë””ì˜¤ ìŠ¤ì¼€ì¹˜"><i id="tts-icon" class="fas fa-volume-up text-purple-400"></i></button>
                        <button id="edit-toggle-btn" class="p-2.5 glass rounded-lg hover:bg-blue-700 transition-all" title="í¸ì§‘ ëª¨ë“œ"><i id="edit-icon" class="fas fa-pen text-blue-300"></i></button>
                        <button id="export-lyrics-btn" class="p-2.5 glass rounded-lg hover:bg-emerald-700 transition-all" title="ê°€ì‚¬ ë‹¤ìš´ë¡œë“œ"><i class="fas fa-download text-emerald-400"></i></button>
                        <button data-copy="output-lyrics" class="p-2.5 glass rounded-lg hover:bg-slate-700 transition-all" title="ë³µì‚¬"><i class="fas fa-file-alt text-blue-400"></i></button>
                    </div>
                </div>
                <div class="editable-hint mb-2">v9.2: âœï¸ ëˆ„ë¥´ë©´ ìƒì„± í›„ "í‹€ë¦° ë¶€ë¶„ë§Œ" ë°”ë¡œ ì†ìœ¼ë¡œ ê³ ì¹  ìˆ˜ ìˆê²Œ í•´ë’€ì–´.</div>

                <div class="mb-3 p-3 glass rounded-lg bg-slate-800/50 border border-cyan-500/30">
                    <!-- ìŒí–¥íš¨ê³¼ (4ê°œ ë“œë¡­ë‹¤ìš´ + ìœ„ì¹˜ ì„ íƒ!) -->
                    <div class="mb-4">
                        <div class="flex items-center justify-between mb-2">
                            <span class="text-xs font-bold text-cyan-300"><i class="fas fa-music"></i> ğŸ¬ ìŒí–¥íš¨ê³¼</span>
                            <span class="text-[10px] text-slate-500">ì„ íƒ â†’ ìœ„ì¹˜ ì§€ì • â†’ ì‚½ì…!</span>
                        </div>
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-2">
                            <select id="sfx-nature" class="p-2 text-xs glass rounded-lg focus:ring-2 focus:ring-blue-500 outline-none cursor-pointer bg-slate-800">
                                <option value="">ğŸŒ¦ï¸ ìì—°/ë‚ ì”¨</option>
                                <option value="[Heavy Rain]">ğŸŒ§ï¸ í­ìš°</option>
                                <option value="[Thunder]">âš¡ ì²œë‘¥</option>
                                <option value="[Ocean Waves]">ğŸŒŠ íŒŒë„</option>
                                <option value="[Wind]">ğŸ’¨ ë°”ëŒ</option>
                                <option value="[Birds Chirping]">ğŸ¦ ìƒˆì†Œë¦¬</option>
                                <option value="[Fire Crackling]">ğŸ”¥ ë¶ˆíƒ€ëŠ”ì†Œë¦¬</option>
                            </select>
                            <select id="sfx-mood" class="p-2 text-xs glass rounded-lg focus:ring-2 focus:ring-purple-500 outline-none cursor-pointer bg-slate-800">
                                <option value="">ğŸµ ë¶„ìœ„ê¸°/íš¨ê³¼</option>
                                <option value="[Vinyl Crackle]">ğŸ“€ ë°”ì´ë‹ ì¡ìŒ</option>
                                <option value="[Lo-fi]">ğŸ§ ë¡œíŒŒì´</option>
                                <option value="[Echo Chamber]">ğŸ”Š ì—ì½”</option>
                                <option value="[Reverb]">ğŸ¤ ë¦¬ë²„ë¸Œ</option>
                                <option value="[Silence]">ğŸ”‡ ì •ì </option>
                            </select>
                            <select id="sfx-instrument" class="p-2 text-xs glass rounded-lg focus:ring-2 focus:ring-yellow-500 outline-none cursor-pointer bg-slate-800">
                                <option value="">ğŸ» ì•…ê¸° ê°•ì¡°</option>
                                <option value="[Orchestral Hit]">ğŸ» ì˜¤ì¼€ìŠ¤íŠ¸ë¼ íƒ€ê²©</option>
                                <option value="[Piano Solo]">ğŸ¹ í”¼ì•„ë…¸ ì†”ë¡œ</option>
                                <option value="[Strings Swell]">ğŸ¼ í˜„ì•… ìŠ¤ì›°</option>
                                <option value="[Guitar Riff]">ğŸ¸ ê¸°íƒ€ ë¦¬í”„</option>
                            </select>
                            <select id="sfx-crowd" class="p-2 text-xs glass rounded-lg focus:ring-2 focus:ring-green-500 outline-none cursor-pointer bg-slate-800">
                                <option value="">ğŸ‘¥ ì‚¬ëŒ/êµ°ì¤‘</option>
                                <option value="[Crowd Cheering]">ğŸ‘ í™˜í˜¸ì„±</option>
                                <option value="[Applause]">ğŸ‘ ë°•ìˆ˜</option>
                                <option value="[Laughter]">ğŸ˜„ ì›ƒìŒì†Œë¦¬</option>
                                <option value="[Heartbeat]">ğŸ’— ì‹¬ì¥ë°•ë™</option>
                                <option value="[Footsteps]">ğŸ‘£ ë°œì†Œë¦¬</option>
                            </select>
                        </div>
                    </div>
                    <p class="text-[10px] text-slate-500 mb-4">ğŸ’¡ ë°œë¼ë“œ ì¶”ì²œ: í­ìš°/ì²œë‘¥/íŒŒë„ (ê°ì„±â†‘), í”¼ì•„ë…¸ ì†”ë¡œ/í˜„ì•… ìŠ¤ì›° (ë“œë¼ë§ˆí‹±), ì •ì  (ì—¬ìš´)</p>

                    <!-- ìŒí–¥íš¨ê³¼ ìœ„ì¹˜ ì„ íƒ ëª¨ë‹¬ -->
                    <div id="sfx-position-modal" class="hidden fixed inset-0 bg-black/80 z-50 flex items-center justify-center">
                        <div class="glass p-6 rounded-2xl max-w-md w-full mx-4 bg-slate-800 border border-cyan-500/30">
                            <h3 class="text-lg font-bold text-cyan-300 mb-4 flex items-center gap-2">
                                <i class="fas fa-map-marker-alt"></i> ìŒí–¥íš¨ê³¼ ì‚½ì… ìœ„ì¹˜ ì„ íƒ
                            </h3>
                            <p class="text-sm text-slate-300 mb-4">
                                <span id="sfx-selected-name" class="text-cyan-400 font-bold"></span>ë¥¼ ì–´ë””ì— ì‚½ì…í• ê¹Œìš”?
                            </p>
                            <div class="space-y-2 mb-6">
                                <button class="sfx-position-btn w-full p-3 glass rounded-lg hover:bg-cyan-600/30 text-left transition-all flex items-center gap-3" data-position="cursor">
                                    <i class="fas fa-i-cursor text-cyan-400"></i>
                                    <div>
                                        <div class="font-semibold">í˜„ì¬ ì»¤ì„œ ìœ„ì¹˜</div>
                                        <div class="text-xs text-slate-400">ì§€ê¸ˆ ìœ„ì¹˜ì— ë°”ë¡œ ì‚½ì…</div>
                                    </div>
                                </button>
                                <button class="sfx-position-btn w-full p-3 glass rounded-lg hover:bg-blue-600/30 text-left transition-all flex items-center gap-3" data-position="intro">
                                    <i class="fas fa-play text-blue-400"></i>
                                    <div>
                                        <div class="font-semibold">ë‹¤ìŒ [Intro] ë‹¤ìŒ</div>
                                        <div class="text-xs text-slate-400">ì„¹ì…˜ ì‹œì‘ì— ì‚½ì… (Suno ì¶”ì²œ!)</div>
                                    </div>
                                </button>
                                <button class="sfx-position-btn w-full p-3 glass rounded-lg hover:bg-purple-600/30 text-left transition-all flex items-center gap-3" data-position="break">
                                    <i class="fas fa-pause text-purple-400"></i>
                                    <div>
                                        <div class="font-semibold">ë‹¤ìŒ [Instrumental Break] ë‹¤ìŒ</div>
                                        <div class="text-xs text-slate-400">ë¸Œë ˆì´í¬ì— ì‚½ì… (ì¶”ì²œ!)</div>
                                    </div>
                                </button>
                                <button class="sfx-position-btn w-full p-3 glass rounded-lg hover:bg-yellow-600/30 text-left transition-all flex items-center gap-3" data-position="bridge">
                                    <i class="fas fa-music text-yellow-400"></i>
                                    <div>
                                        <div class="font-semibold">ë‹¤ìŒ [Bridge] ë‹¤ìŒ</div>
                                        <div class="text-xs text-slate-400">ë¸Œë¦¿ì§€ì— ì‚½ì…</div>
                                    </div>
                                </button>
                            </div>
                            <button id="sfx-position-cancel" class="w-full p-2 glass rounded-lg hover:bg-slate-600/50 text-sm transition-all">
                                ì·¨ì†Œ
                            </button>
                        </div>
                    </div>
                </div>

                <div id="single-lyrics-container">
                    <div id="output-lyrics" class="output-box bg-slate-900/50 p-4 rounded-xl whitespace-pre-wrap leading-relaxed text-sm h-[380px] overflow-y-auto font-mono border border-slate-700/50 mb-4 placeholder-text" contenteditable="false" spellcheck="false">ğŸµ Suno AI ê°€ì‚¬ ì‘ì„± ì™„ë²½ ê°€ì´ë“œ

ğŸ“Œ **ê¸°ë³¸ ì‚¬ìš©ë²•:**
1ï¸âƒ£ ì£¼ì œ ì…ë ¥ â†’ 2ï¸âƒ£ ì¥ë¥´ ì„ íƒ â†’ 3ï¸âƒ£ ìƒì„± í´ë¦­!

ğŸ¼ **ìŒí–¥íš¨ê³¼ ë„£ëŠ” ë°©ë²•:**
â€¢ [Intro] ì•ì—: (Acoustic guitar, warm atmosphere)
â€¢ [Verse 1] ì•ì—: (Piano-driven, intimate vocal)
â€¢ [Chorus] ì•ì—: (Full instrumentation, rich harmonies)
â€¢ [Bridge] ì•ì—: (Stripped down, emotional)

ğŸ’¡ **ê° ì„¹ì…˜ë§ˆë‹¤ 1ê°œì”©ë§Œ** ê´„í˜¸ë¡œ ì§€ì‹œ!

ğŸ¯ **êµ¬ì¡° íƒœê·¸ (í•„ìˆ˜!):**
[Intro] â†’ [Verse 1] â†’ [Pre-Chorus] â†’ [Chorus]
â†’ [Verse 2] â†’ [Chorus] â†’ [Bridge] 
â†’ [Final Chorus] â†’ [Outro]

âš ï¸ **í”í•œ ì‹¤ìˆ˜:**
âŒ ê°€ì‚¬ê°€ ë„ˆë¬´ ë§ìœ¼ë©´ â†’ ë©ì²˜ëŸ¼ ë¹¨ë¼ì§!
âŒ ìŒí–¥íš¨ê³¼ ì—¬ëŸ¬ ê°œ â†’ ë¬´ì‹œë¨!
âŒ íƒœê·¸ ì—†ìœ¼ë©´ â†’ êµ¬ì¡° ì—‰ë§!

âœ… **ê¿€íŒ:**
â€¢ ë°œë¼ë“œ: 3~5ìŒì ˆ ì§§ê²Œ!
â€¢ K-Pop: í›„ë ´êµ¬ ë°˜ë³µ OK!
â€¢ ë¡œíŒŒì´: ê°€ì‚¬ ìµœì†Œë¡œ!
â€¢ í™í•©: 7~12ìŒì ˆ ììœ ë¡­ê²Œ!

ğŸ­ A/B ëª¨ë“œë¡œ ë‘ ë²„ì „ ë¹„êµ ê°€ëŠ¥!
âœ¨ ê°„í¸ ëª¨ë“œëŠ” ì™¼ìª½ íƒ­ì—ì„œ!

ì¤€ë¹„ëìœ¼ë©´ ì‹œì‘í•´ë³¼ê¹Œ? ğŸ˜Š</div>
                </div>

                <div id="ab-lyrics-container" class="hidden grid grid-cols-2 gap-4 mb-4">
                    <div class="glass p-3 rounded-xl bg-slate-800/50 border-2 border-green-500/50">
                        <div class="flex justify-between items-center mb-2">
                            <h4 class="text-xs font-bold text-green-300"><i class="fas fa-music"></i> ë²„ì „ A</h4>
                            <div class="flex gap-1">
                                <button data-tts="A" class="p-1.5 glass rounded hover:bg-purple-700 transition-all text-xs"><i id="tts-icon-a" class="fas fa-volume-up text-purple-400"></i></button>
                                <button data-use="A" class="p-1.5 glass rounded hover:bg-green-700 transition-all text-xs"><i class="fas fa-check text-green-400"></i></button>
                            </div>
                        </div>
                        <div id="output-lyrics-a" class="bg-slate-900/50 p-3 rounded-lg whitespace-pre-wrap text-xs h-[330px] overflow-y-auto font-mono border border-slate-700/30" contenteditable="false" spellcheck="false">ì—¬ê¸°ì— ë²„ì „ A ìƒì„±</div>
                    </div>
                    <div class="glass p-3 rounded-xl bg-slate-800/50 border-2 border-blue-500/50">
                        <div class="flex justify-between items-center mb-2">
                            <h4 class="text-xs font-bold text-blue-300"><i class="fas fa-music"></i> ë²„ì „ B</h4>
                            <div class="flex gap-1">
                                <button data-tts="B" class="p-1.5 glass rounded hover:bg-purple-700 transition-all text-xs"><i id="tts-icon-b" class="fas fa-volume-up text-purple-400"></i></button>
                                <button data-use="B" class="p-1.5 glass rounded hover:bg-blue-700 transition-all text-xs"><i class="fas fa-check text-blue-400"></i></button>
                            </div>
                        </div>
                        <div id="output-lyrics-b" class="bg-slate-900/50 p-3 rounded-lg whitespace-pre-wrap text-xs h-[330px] overflow-y-auto font-mono border border-slate-700/30" contenteditable="false" spellcheck="false">ë‹¤ì‹œ ìƒì„±í•˜ë©´ ì—¬ê¸°ì— ë²„ì „ B ìƒì„±</div>
                    </div>
                </div>

                <div id="ai-report" class="ai-report p-4 rounded-xl hidden">
                    <h4 class="text-sm font-bold mb-3 text-emerald-300 flex items-center gap-2"><i class="fas fa-robot"></i> AI í’ˆì§ˆ ê²€ìˆ˜ ë¦¬í¬íŠ¸</h4>
                    <div id="report-content" class="space-y-2 text-xs text-slate-300"></div>
                </div>
            </div>

            <div class="space-y-6">
                <div class="glass p-5 rounded-2xl border-l-4 border-emerald-500">
                    <div class="flex justify-between items-center mb-3">
                        <h3 class="text-base font-bold flex items-center gap-2"><i class="fas fa-music text-emerald-400"></i> Suno Style</h3>
                        <button data-copy="output-style" class="p-2 glass rounded-lg hover:bg-slate-700 transition-all" title="ë³µì‚¬"><i class="fas fa-music text-emerald-400"></i></button>
                    </div>
                    <div id="output-style" class="output-box bg-slate-900/50 p-3 rounded-xl text-xs italic h-[185px] overflow-y-auto whitespace-pre-wrap border border-slate-700/50">ìŠ¤íƒ€ì¼ í”„ë¡¬í”„íŠ¸ê°€ ì—¬ê¸°ì— ìƒì„±ë¼.</div>
                </div>

                <div class="glass p-5 rounded-2xl border-l-4 border-orange-500">
                    <div class="flex justify-between items-center mb-3">
                        <h3 class="text-base font-bold flex items-center gap-2"><i class="fas fa-sliders-h text-orange-400"></i> ìŒì•… ì´ë¡  (BPM/Key)</h3>
                        <button data-copy="output-music-theory" class="p-2 glass rounded-lg hover:bg-slate-700 transition-all" title="ë³µì‚¬"><i class="fas fa-sliders-h text-orange-400"></i></button>
                    </div>
                    <div id="output-music-theory" class="output-box bg-slate-900/50 p-3 rounded-xl text-xs h-[120px] overflow-y-auto whitespace-pre-wrap border border-slate-700/50 font-mono">AIê°€ ê³¡ì˜ ë¬´ë“œì— ìµœì í™”ëœ BPMê³¼ Keyë¥¼ ì¶”ì²œí•´ì¤˜!</div>
                </div>

                <div class="glass p-5 rounded-2xl border-l-4 border-rose-500">
                    <div class="flex justify-between items-center mb-3">
                        <h3 class="text-base font-bold flex items-center gap-2"><i class="fas fa-video text-rose-400"></i> Veo Video</h3>
                        <button data-copy="output-video" class="p-2 glass rounded-lg hover:bg-slate-700 transition-all" title="ë³µì‚¬"><i class="fas fa-video text-rose-400"></i></button>
                    </div>
                    <div id="output-video" class="output-box bg-slate-900/50 p-3 rounded-xl text-xs h-[185px] overflow-y-auto whitespace-pre-wrap border border-slate-700/50">ì‡¼ì¸  ì œì‘ì„ ìœ„í•œ ì˜ìƒ ë¬˜ì‚¬.</div>
                </div>

                <div class="glass p-5 rounded-2xl border-l-4 border-yellow-500">
                    <div class="flex justify-between items-center mb-3">
                        <h3 class="text-base font-bold flex items-center gap-2"><i class="fas fa-image text-yellow-400"></i> Album Art</h3>
                        <button data-copy="output-art" class="p-2 glass rounded-lg hover:bg-slate-700 transition-all" title="ë³µì‚¬"><i class="fas fa-image text-yellow-400"></i></button>
                    </div>
                    <div id="output-art" class="output-box bg-slate-900/50 p-3 rounded-xl text-xs h-[185px] overflow-y-auto whitespace-pre-wrap border border-slate-700/50">ì•¨ë²” ì»¤ë²„ í”„ë¡¬í”„íŠ¸.</div>
                </div>

                <div class="glass p-5 rounded-2xl border-l-4 border-green-500">
                    <div class="flex justify-between items-center mb-3">
                        <h3 class="text-base font-bold flex items-center gap-2"><i class="fas fa-globe text-green-400"></i> ê¸€ë¡œë²Œ ë²ˆì—­</h3>
                        <button data-copy="output-translation" class="p-2 glass rounded-lg hover:bg-slate-700 transition-all" title="ë³µì‚¬"><i class="fas fa-globe text-green-400"></i></button>
                    </div>
                    <div id="output-translation" class="output-box bg-slate-900/50 p-3 rounded-xl text-xs h-[240px] overflow-y-auto whitespace-pre-wrap border border-slate-700/50 font-mono">ì˜ì–´ ë²ˆì—­ ê°€ì‚¬.</div>
                </div>

                <div class="glass p-5 rounded-2xl border-l-4 border-violet-500">
                    <div class="flex justify-between items-center mb-3">
                        <h3 class="text-base font-bold flex items-center gap-2"><i class="fas fa-bullhorn text-violet-400"></i> SNS ë§ˆì¼€íŒ…</h3>
                        <button data-copy="output-marketing" class="p-2 glass rounded-lg hover:bg-slate-700 transition-all" title="ë³µì‚¬"><i class="fas fa-bullhorn text-violet-400"></i></button>
                    </div>
                    <div id="output-marketing" class="output-box bg-slate-900/50 p-3 rounded-xl text-xs h-[240px] overflow-y-auto whitespace-pre-wrap border border-slate-700/50">ìœ íŠœë¸Œ ì‡¼ì¸  ì œëª©, ì„¤ëª…, í•´ì‹œíƒœê·¸.</div>
                </div>
            </div>
        </div>

        <footer class="mt-8 glass p-4 rounded-xl text-xs text-slate-400">
            <div class="flex items-start gap-2">
                <i class="fas fa-lightbulb text-yellow-400 mt-1"></i>
                <div>
                    <strong class="text-slate-200">8ëŒ€ ì›ì¹™ ì²´í¬:</strong>
                    â‘  3~5ìŒì ˆ â‘¡ Final 7~8ì¤„ â‘¢ ì½”ëŸ¬ìŠ¤ ì•µì»¤ 1ì¤„ë§Œ â‘£ ë©œë¡œë”” ë³€í™” â‘¤ ë¡±í†¤ ë¬¼ê²°í‘œ(~) â‘¥ ëŒ€ìœ„ë²• 1~2íšŒ (ë¬¼ê²°í‘œX) â‘¦ Final 3ê²¹ í™”ìŒ â‘§ ì• ë“œë¦½ 2ì¤„
                </div>
            </div>
        </footer>
    </div>

    <script>
        // =====================================================
        // v9.2 ULTIMATE EDITION
        // ì§€í”¼í‹° 7ëŒ€ ê¸°ëŠ¥ + v9.0 ìƒì„¸ í”„ë¡¬í”„íŠ¸ ì™„ë²½ ê²°í•©!
        // =====================================================
        
        const STORAGE = {
            KEY_LOCAL: 'suno_helper_api_key',
            KEY_SESSION: 'suno_helper_api_key_session',
            MODEL: 'suno_helper_model',
            HISTORY: 'suno_helper_history',
            PRESETS: 'sunoPresets',
            TTS_KEY: 'suno_helper_tts_key',
            TTS_VOICE: 'suno_helper_tts_voice',
            TTS_ENABLED: 'suno_helper_tts_enabled'
        };

        let apiKey = '';
        let modelName = 'gemini-3-flash-preview';
        let historyData = [];
        let editMode = false;
        let abModeActive = false;
        let versionALyrics = '';
        let versionBLyrics = '';
        let ttsActive = false;
        let ttsActiveA = false;
        let ttsActiveB = false;
        let currentUtterance = null;
        let availableVoices = [];
        
        // Google Cloud TTS
        let ttsApiKey = '';
        let ttsVoiceName = 'ko-KR-Neural2-A'; // ê¸°ë³¸: ì—¬ì„± ì‹ ê²½ë§ ìŒì„±
        let useTTS = false; // TTS ì‚¬ìš© ì—¬ë¶€ (ê¸°ë³¸ êº¼ì§)
        let currentAudio = null; // ì¬ìƒ ì¤‘ì¸ ì˜¤ë””ì˜¤
        let lastFocusedLyricsId = 'output-lyrics';
        let activeControllers = [];
        let generating = false;

        const $ = (id) => document.getElementById(id);
        const q = (sel, root=document) => root.querySelector(sel);
        const qa = (sel, root=document) => Array.from(root.querySelectorAll(sel));

        function showStatus(msg, type='info') {
            const toast = document.createElement('div');
            const typeMap = {
                success: 'bg-emerald-500/20 border-emerald-500 text-emerald-100',
                error: 'bg-red-500/20 border-red-500 text-red-100',
                warn: 'bg-amber-500/20 border-amber-500 text-amber-100',
                info: 'glass text-white'
            };
            const bgClass = typeMap[type] || typeMap.info;
            toast.className = `fixed bottom-10 left-1/2 -translate-x-1/2 px-6 py-3 rounded-full ${bgClass} font-bold z-[100] transition-all duration-300 border border-white/10 shadow-lg backdrop-blur-md`;
            toast.innerText = msg;
            document.body.appendChild(toast);
            setTimeout(() => {
                toast.classList.add('opacity-0', 'translate-y-4');
                setTimeout(() => toast.remove(), 300);
            }, 2000);
        }

        function toggleSettings(force) {
            const modal = $('settings-modal');
            if (typeof force === 'boolean') modal.classList.toggle('hidden', !force);
            else modal.classList.toggle('hidden');
        }

        function toggleHistory(force) {
            const modal = $('history-modal');
            if (typeof force === 'boolean') modal.classList.toggle('hidden', !force);
            else modal.classList.toggle('hidden');
            if (!modal.classList.contains('hidden')) renderHistory();
        }

        // v9.2: ì „ë¶€ ë¹„ìš°ê¸° ê¸°ëŠ¥
        function clearAllOutputs() {
            // í™•ì¸ ë‹¤ì´ì–¼ë¡œê·¸
            const confirmed = confirm('ğŸ—‘ï¸ ëª¨ë“  ì¶œë ¥ ë‚´ìš©ì„ ë¹„ìš¸ê¹Œìš”?\n\nê°€ì‚¬, ìŠ¤íƒ€ì¼, ìŒì•… ì´ë¡ , ë²ˆì—­, ë§ˆì¼€íŒ… ë“± ëª¨ë“  ìƒì„±ëœ ë‚´ìš©ì´ ì‚­ì œë©ë‹ˆë‹¤.\n\n(ë³´ê´€í•¨ì— ì €ì¥ëœ ë‚´ìš©ì€ ìœ ì§€ë©ë‹ˆë‹¤)');
            
            if (!confirmed) return;
            
            // ëª¨ë“  ì¶œë ¥ì°½ ì´ˆê¸°í™”
            $('output-lyrics').innerText = 'ğŸµ Suno AI ê°€ì‚¬ ì‘ì„± ì™„ë²½ ê°€ì´ë“œ\n\nğŸ“Œ **ê¸°ë³¸ ì‚¬ìš©ë²•:**\n1ï¸âƒ£ ì£¼ì œ ì…ë ¥ â†’ 2ï¸âƒ£ ì¥ë¥´ ì„ íƒ â†’ 3ï¸âƒ£ ìƒì„± í´ë¦­!\n\nğŸ¼ **ìŒí–¥íš¨ê³¼ ë„£ëŠ” ë°©ë²•:**\nâ€¢ [Intro] ì•ì—: (Acoustic guitar, warm atmosphere)\nâ€¢ [Verse 1] ì•ì—: (Piano-driven, intimate vocal)\nâ€¢ [Chorus] ì•ì—: (Full instrumentation, rich harmonies)\nâ€¢ [Bridge] ì•ì—: (Stripped down, emotional)\n\nğŸ’¡ **ê° ì„¹ì…˜ë§ˆë‹¤ 1ê°œì”©ë§Œ** ê´„í˜¸ë¡œ ì§€ì‹œ!\n\nğŸ¯ **êµ¬ì¡° íƒœê·¸ (í•„ìˆ˜!):**\n[Intro] â†’ [Verse 1] â†’ [Pre-Chorus] â†’ [Chorus]\nâ†’ [Verse 2] â†’ [Chorus] â†’ [Bridge] \nâ†’ [Final Chorus] â†’ [Outro]\n\nâš ï¸ **í”í•œ ì‹¤ìˆ˜:**\nâŒ ê°€ì‚¬ê°€ ë„ˆë¬´ ë§ìœ¼ë©´ â†’ ë©ì²˜ëŸ¼ ë¹¨ë¼ì§!\nâŒ ìŒí–¥íš¨ê³¼ ì—¬ëŸ¬ ê°œ â†’ ë¬´ì‹œë¨!\nâŒ íƒœê·¸ ì—†ìœ¼ë©´ â†’ êµ¬ì¡° ì—‰ë§!\n\nâœ… **ê¿€íŒ:**\nâ€¢ ë°œë¼ë“œ: 3~5ìŒì ˆ ì§§ê²Œ!\nâ€¢ K-Pop: í›„ë ´êµ¬ ë°˜ë³µ OK!\nâ€¢ ë¡œíŒŒì´: ê°€ì‚¬ ìµœì†Œë¡œ!\nâ€¢ í™í•©: 7~12ìŒì ˆ ììœ ë¡­ê²Œ!\n\nğŸ­ A/B ëª¨ë“œë¡œ ë‘ ë²„ì „ ë¹„êµ ê°€ëŠ¥!\nâœ¨ ê°„í¸ ëª¨ë“œëŠ” ì™¼ìª½ íƒ­ì—ì„œ!\n\nì¤€ë¹„ëìœ¼ë©´ ì‹œì‘í•´ë³¼ê¹Œ? ğŸ˜Š';
            $('output-lyrics').classList.add('placeholder-text');
            $('output-lyrics-a').innerText = 'ì—¬ê¸°ì— Aë²„ì „ ê°€ì‚¬ê°€ ìƒì„±ë¼! ğŸµ';
            $('output-lyrics-b').innerText = 'ì—¬ê¸°ì— Bë²„ì „ ê°€ì‚¬ê°€ ìƒì„±ë¼! ğŸµ';
            $('output-style').innerText = '';
            $('output-music-theory').innerText = 'ìƒì„±ë˜ë©´ ì—¬ê¸° í‘œì‹œë¼! ğŸ¼';
            $('output-translation').innerText = 'âšª ìƒì„±í•˜ì§€ ì•ŠìŒ';
            $('output-marketing').innerText = 'âšª ìƒì„±í•˜ì§€ ì•ŠìŒ';
            $('output-video').innerText = 'âšª ìƒì„±í•˜ì§€ ì•ŠìŒ';
            $('output-art').innerText = 'âšª ìƒì„±í•˜ì§€ ì•ŠìŒ';
            
            // A/B ëª¨ë“œ ë²„ì „ ë³€ìˆ˜ë„ ì´ˆê¸°í™”
            versionALyrics = '';
            versionBLyrics = '';
            
            // í¸ì§‘ ëª¨ë“œ ë„ê¸°
            if (editMode) {
                editMode = false;
                $('edit-icon').className = 'fas fa-pen text-blue-300';
                $('output-lyrics').contentEditable = 'false';
                $('output-lyrics-a').contentEditable = 'false';
                $('output-lyrics-b').contentEditable = 'false';
            }
            
            showStatus('ëª¨ë“  ì¶œë ¥ ë‚´ìš©ì„ ê¹¨ë—í•˜ê²Œ ë¹„ì› ì–´! ğŸ—‘ï¸âœ¨', 'success');
        }

        async function copyText(text) {
            if (!text || !text.trim()) {
                showStatus('ë³µì‚¬í•  ë‚´ìš©ì´ ì—†ì–´!', 'error');
                return;
            }
            try {
                await navigator.clipboard.writeText(text);
                showStatus('ë³µì‚¬ ì™„ë£Œ! ğŸ“‹', 'success');
            } catch {
                const temp = document.createElement('textarea');
                temp.value = text;
                document.body.appendChild(temp);
                temp.select();
                document.execCommand('copy');
                document.body.removeChild(temp);
                showStatus('ë³µì‚¬ ì™„ë£Œ! ğŸ“‹', 'success');
            }
        }

        function copyFromElement(elementId) {
            const el = $(elementId);
            if (!el) return;
            const text = el.innerText;
            if (!text.trim() || text.includes('ê°€ì‚¬ ìƒì„± ì¤€ë¹„')) {
                showStatus('ë³µì‚¬í•  ë‚´ìš©ì´ ì—†ì–´!', 'error');
                return;
            }
            copyText(text);
        }

        function exportLyrics() {
            const lyrics = getActiveLyricsElement().innerText;
            if (!lyrics.trim() || lyrics.includes('ê°€ì‚¬ ìƒì„± ì¤€ë¹„')) {
                showStatus('ë‚´ë³´ë‚¼ ê°€ì‚¬ê°€ ì—†ì–´!', 'error');
                return;
            }
            const keyword = $('keyword').value || 'Unknown';
            const filename = `${keyword.replace(/[\\/:*?"<>|]/g, '_').trim().slice(0, 40)}_Lyrics.txt`;
            const blob = new Blob([lyrics], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            a.click();
            URL.revokeObjectURL(url);
            showStatus('ê°€ì‚¬ ë‹¤ìš´ë¡œë“œ ì™„ë£Œ! ğŸ“¥', 'success');
        }

        // v9.2: í¸ì§‘ ëª¨ë“œ
        function setEditable(el, on) {
            if (!el) return;
            el.setAttribute('contenteditable', on ? 'true' : 'false');
            if (on) el.classList.add('editable-on');
            else el.classList.remove('editable-on');
        }

        function toggleEditMode() {
            editMode = !editMode;
            const icon = $('edit-icon');
            setEditable($('output-lyrics'), editMode);
            setEditable($('output-lyrics-a'), editMode);
            setEditable($('output-lyrics-b'), editMode);

            if (editMode) {
                icon.className = 'fas fa-lock-open text-emerald-300';
                showStatus('í¸ì§‘ ëª¨ë“œ ON âœï¸', 'success');
            } else {
                icon.className = 'fas fa-pen text-blue-300';
                showStatus('í¸ì§‘ ëª¨ë“œ OFF ğŸ”’', 'info');
            }
            debounceReport();
        }

        let reportTimer = null;
        function debounceReport() {
            clearTimeout(reportTimer);
            reportTimer = setTimeout(() => {
                const lyricsText = getActiveLyricsTextForReport();
                if (lyricsText && !lyricsText.includes('ê°€ì‚¬ ìƒì„± ì¤€ë¹„')) generateAIReport(lyricsText);
            }, 250);
        }

        function getActiveLyricsTextForReport() {
            if (abModeActive) {
                const el = $(lastFocusedLyricsId) || $('output-lyrics-b') || $('output-lyrics-a');
                return el?.innerText || '';
            }
            return $('output-lyrics').innerText;
        }

        function getActiveLyricsElement() {
            if (abModeActive) {
                return $(lastFocusedLyricsId) || $('output-lyrics-b') || $('output-lyrics-a');
            }
            return $('output-lyrics');
        }

        function insertTag(tag) {
            const el = getActiveLyricsElement();
            if (!el) return;
            const currentText = el.innerText;
            if (currentText.includes('ê°€ì‚¬ ìƒì„± ì¤€ë¹„')) {
                el.innerText = tag + '\n';
            } else {
                el.innerText = currentText + '\n' + tag;
            }
            showStatus(`${tag} íƒœê·¸ ì‚½ì…! ğŸµ`, 'success');
            el.scrollTop = el.scrollHeight;
            debounceReport();
        }

        // v9.2: ìŒí–¥íš¨ê³¼ ìœ„ì¹˜ ì„ íƒ ì‹œìŠ¤í…œ
        let pendingSFXTag = '';
        let pendingSFXName = '';

        function showSFXPositionModal(tag, displayName) {
            pendingSFXTag = tag;
            pendingSFXName = displayName;
            $('sfx-selected-name').innerText = displayName;
            $('sfx-position-modal').classList.remove('hidden');
        }

        function hideSFXPositionModal() {
            $('sfx-position-modal').classList.add('hidden');
            pendingSFXTag = '';
            pendingSFXName = '';
        }

        function insertSFXAtPosition(tag, position) {
            const el = getActiveLyricsElement();
            if (!el) {
                showStatus('ê°€ì‚¬ì°½ì„ ë¨¼ì € ìƒì„±í•´ì¤˜! ğŸµ', 'warn');
                return;
            }

            let currentText = el.innerText;
            if (currentText.includes('ê°€ì‚¬ ìƒì„± ì¤€ë¹„')) {
                currentText = '';
            }

            let newText = '';
            const lines = currentText.split('\n');

            if (position === 'cursor') {
                // í˜„ì¬ ìœ„ì¹˜ì— ì‚½ì…
                newText = currentText + '\n' + tag;
            } else {
                // ì„¹ì…˜ ë‹¤ìŒì— ì‚½ì…
                const sectionMap = {
                    'intro': '[Intro]',
                    'break': '[Instrumental Break]',
                    'bridge': '[Bridge]'
                };
                const sectionTag = sectionMap[position];
                let insertIndex = -1;

                // ì„¹ì…˜ ì°¾ê¸°
                for (let i = 0; i < lines.length; i++) {
                    if (lines[i].includes(sectionTag)) {
                        insertIndex = i;
                        break;
                    }
                }

                if (insertIndex !== -1) {
                    // ì„¹ì…˜ ë‹¤ìŒ ì¤„ì— ì‚½ì… (ë””ë ‰íŒ… ê´„í˜¸ ë‹¤ìŒ)
                    let targetIndex = insertIndex + 1;
                    // ë””ë ‰íŒ…ì´ ìˆìœ¼ë©´ ê·¸ ë‹¤ìŒ
                    if (targetIndex < lines.length && lines[targetIndex].trim().startsWith('(')) {
                        targetIndex++;
                    }
                    lines.splice(targetIndex, 0, tag);
                    newText = lines.join('\n');
                    showStatus(`${sectionTag} ë‹¤ìŒì— ${tag} ì‚½ì…! ğŸµ`, 'success');
                } else {
                    // ì„¹ì…˜ ëª» ì°¾ìœ¼ë©´ ëì— ì‚½ì…
                    newText = currentText + '\n' + tag;
                    showStatus(`${sectionTag}ë¥¼ ëª» ì°¾ì•„ì„œ ëì— ì‚½ì…í–ˆì–´! ğŸµ`, 'warn');
                }
            }

            el.innerText = newText;
            el.scrollTop = el.scrollHeight;
            debounceReport();
            hideSFXPositionModal();
        }

        // v9.2: TTS ìŒì„± ë¡œë”© ê°œì„ 
        function loadVoices() {
            if (!('speechSynthesis' in window)) return;
            availableVoices = window.speechSynthesis.getVoices() || [];
        }

        function pickKoreanVoice() {
            if (!availableVoices || availableVoices.length === 0) loadVoices();
            return availableVoices.find(v => (v.lang || '').startsWith('ko')) || availableVoices[0] || null;
        }

        function cleanLyricsForTTS(raw) {
            return (raw || '').replace(/\[.*?\]/g, '').replace(/\(.*?\)/g, '').replace(/-+/g, '').trim();
        }

        // Google Cloud Text-to-Speech API í˜¸ì¶œ
        async function callGoogleCloudTTS(text) {
            if (!ttsApiKey) {
                throw new Error('Google Cloud TTS API í‚¤ê°€ ì—†ì–´ìš”!');
            }

            const url = `https://texttospeech.googleapis.com/v1/text:synthesize?key=${ttsApiKey}`;
            
            const requestBody = {
                input: { text: text },
                voice: {
                    languageCode: 'ko-KR',
                    name: ttsVoiceName
                },
                audioConfig: {
                    audioEncoding: 'MP3',
                    speakingRate: 0.85,
                    pitch: 0.0
                }
            };

            try {
                const response = await fetch(url, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(requestBody)
                });

                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(error.error?.message || 'TTS API í˜¸ì¶œ ì‹¤íŒ¨!');
                }

                const data = await response.json();
                return data.audioContent; // base64 encoded audio
            } catch (error) {
                throw error;
            }
        }

        // base64 ì˜¤ë””ì˜¤ë¥¼ Audio ê°ì²´ë¡œ ì¬ìƒ
        function playBase64Audio(base64Audio, onStart, onEnd, onError) {
            try {
                const audioData = `data:audio/mp3;base64,${base64Audio}`;
                const audio = new Audio(audioData);
                
                audio.onloadeddata = () => {
                    if (onStart) onStart();
                    audio.play().catch(err => {
                        if (onError) onError(err);
                    });
                };
                
                audio.onended = () => {
                    if (onEnd) onEnd();
                };
                
                audio.onerror = (err) => {
                    if (onError) onError(err);
                };
                
                return audio;
            } catch (error) {
                if (onError) onError(error);
                return null;
            }
        }

        function stopAllTTS() {
            // Google Cloud TTS ì˜¤ë””ì˜¤ ì •ì§€
            if (currentAudio) {
                currentAudio.pause();
                currentAudio = null;
            }
            
            // Web Speech API ì •ì§€
            if ('speechSynthesis' in window) {
                window.speechSynthesis.cancel();
            }
            
            ttsActive = false;
            ttsActiveA = false;
            ttsActiveB = false;
            $('tts-icon').className = 'fas fa-volume-up text-purple-400';
            if ($('tts-icon-a')) $('tts-icon-a').className = 'fas fa-volume-up text-purple-400';
            if ($('tts-icon-b')) $('tts-icon-b').className = 'fas fa-volume-up text-purple-400';
        }

        async function toggleTTSMain() {
            const el = $('output-lyrics');
            const raw = el.innerText;
            if (!raw.trim() || raw.includes('ê°€ì‚¬ ìƒì„± ì¤€ë¹„')) {
                showStatus('ì¬ìƒí•  ê°€ì‚¬ê°€ ì—†ì–´! ğŸµ', 'error');
                return;
            }

            const icon = $('tts-icon');
            if (ttsActive) {
                stopAllTTS();
                showStatus('ì˜¤ë””ì˜¤ ìŠ¤ì¼€ì¹˜ ì •ì§€! â¹ï¸', 'info');
                return;
            }

            const clean = cleanLyricsForTTS(raw);
            if (!clean) {
                showStatus('ì½ì„ ê°€ì‚¬ ë‚´ìš©ì´ ì—†ì–´! ğŸ˜¢', 'error');
                return;
            }

            // Google Cloud TTS ì‚¬ìš©
            if (useTTS && ttsApiKey) {
                try {
                    icon.className = 'fas fa-spinner fa-spin text-purple-400';
                    showStatus('ê³ í’ˆì§ˆ AI ìŒì„± ìƒì„± ì¤‘... ğŸ™ï¸', 'info');
                    
                    const base64Audio = await callGoogleCloudTTS(clean);
                    
                    currentAudio = playBase64Audio(
                        base64Audio,
                        () => {
                            ttsActive = true;
                            icon.className = 'fas fa-stop text-red-400 animate-pulse';
                            showStatus('AI ì˜¤ë””ì˜¤ ìŠ¤ì¼€ì¹˜ ì¬ìƒ ì¤‘... ğŸ§', 'info');
                        },
                        () => {
                            ttsActive = false;
                            currentAudio = null;
                            icon.className = 'fas fa-volume-up text-purple-400';
                            showStatus('ì˜¤ë””ì˜¤ ìŠ¤ì¼€ì¹˜ ì™„ë£Œ! âœ¨', 'success');
                        },
                        (error) => {
                            ttsActive = false;
                            currentAudio = null;
                            icon.className = 'fas fa-volume-up text-purple-400';
                            showStatus(`TTS ì˜¤ë¥˜: ${error.message} ğŸ˜¢`, 'error');
                        }
                    );
                } catch (error) {
                    icon.className = 'fas fa-volume-up text-purple-400';
                    showStatus(`TTS API ì˜¤ë¥˜: ${error.message} ğŸ˜¢`, 'error');
                }
                return;
            }

            // Web Speech API ì‚¬ìš© (ê¸°ë³¸)
            if (!('speechSynthesis' in window)) {
                showStatus('ì´ ë¸Œë¼ìš°ì €ëŠ” TTSë¥¼ ì§€ì›í•˜ì§€ ì•Šì•„! ğŸ˜¢', 'error');
                return;
            }

            currentUtterance = new SpeechSynthesisUtterance(clean);
            const voice = pickKoreanVoice();
            if (voice) currentUtterance.voice = voice;
            currentUtterance.lang = 'ko-KR';
            currentUtterance.rate = 0.85;
            currentUtterance.pitch = 1.0;

            currentUtterance.onstart = () => {
                ttsActive = true;
                icon.className = 'fas fa-stop text-red-400 animate-pulse';
                showStatus('AI ì˜¤ë””ì˜¤ ìŠ¤ì¼€ì¹˜ ì¬ìƒ ì¤‘... ğŸ§', 'info');
            };
            currentUtterance.onend = () => {
                ttsActive = false;
                icon.className = 'fas fa-volume-up text-purple-400';
                showStatus('ì˜¤ë””ì˜¤ ìŠ¤ì¼€ì¹˜ ì™„ë£Œ! âœ¨', 'success');
            };
            currentUtterance.onerror = () => {
                ttsActive = false;
                icon.className = 'fas fa-volume-up text-purple-400';
            };

            window.speechSynthesis.speak(currentUtterance);
        }

        async function performTTS(lyricsId, iconId, version) {
            const el = $(lyricsId);
            const raw = el.innerText;
            const icon = $(iconId);

            if (!raw.trim() || raw.includes('ì—¬ê¸°ì—')) {
                showStatus(`ë²„ì „ ${version} ê°€ì‚¬ê°€ ì—†ì–´! ğŸµ`, 'error');
                return;
            }

            const active = (version === 'A') ? ttsActiveA : ttsActiveB;
            if (active) {
                stopAllTTS();
                return;
            }

            const clean = cleanLyricsForTTS(raw);
            
            // Google Cloud TTS ì‚¬ìš©
            if (useTTS && ttsApiKey) {
                try {
                    icon.className = 'fas fa-spinner fa-spin text-purple-400';
                    
                    const base64Audio = await callGoogleCloudTTS(clean);
                    
                    currentAudio = playBase64Audio(
                        base64Audio,
                        () => {
                            if (version === 'A') ttsActiveA = true;
                            else ttsActiveB = true;
                            icon.className = 'fas fa-stop text-red-400 animate-pulse';
                        },
                        () => {
                            if (version === 'A') ttsActiveA = false;
                            else ttsActiveB = false;
                            currentAudio = null;
                            icon.className = 'fas fa-volume-up text-purple-400';
                        },
                        (error) => {
                            if (version === 'A') ttsActiveA = false;
                            else ttsActiveB = false;
                            currentAudio = null;
                            icon.className = 'fas fa-volume-up text-purple-400';
                            showStatus(`TTS ì˜¤ë¥˜: ${error.message} ğŸ˜¢`, 'error');
                        }
                    );
                } catch (error) {
                    icon.className = 'fas fa-volume-up text-purple-400';
                    showStatus(`TTS API ì˜¤ë¥˜: ${error.message} ğŸ˜¢`, 'error');
                }
                return;
            }
            
            // Web Speech API ì‚¬ìš© (ê¸°ë³¸)
            const utterance = new SpeechSynthesisUtterance(clean);
            const voice = pickKoreanVoice();
            if (voice) utterance.voice = voice;
            utterance.lang = 'ko-KR';
            utterance.rate = 0.85;

            utterance.onstart = () => {
                if (version === 'A') ttsActiveA = true;
                else ttsActiveB = true;
                icon.className = 'fas fa-stop text-red-400 animate-pulse';
            };
            utterance.onend = () => {
                if (version === 'A') ttsActiveA = false;
                else ttsActiveB = false;
                icon.className = 'fas fa-volume-up text-purple-400';
            };

            window.speechSynthesis.speak(utterance);
        }

        function toggleABMode() {
            abModeActive = !abModeActive;
            const singleContainer = $('single-lyrics-container');
            const abContainer = $('ab-lyrics-container');
            const toggleBtn = $('ab-toggle-btn');

            if (abModeActive) {
                singleContainer.classList.add('hidden');
                abContainer.classList.remove('hidden');
                toggleBtn.classList.add('bg-indigo-600/70');

                const currentLyrics = $('output-lyrics').innerText;
                if (currentLyrics && !currentLyrics.includes('ê°€ì‚¬ ìƒì„± ì¤€ë¹„')) {
                    versionALyrics = currentLyrics;
                    $('output-lyrics-a').innerText = versionALyrics;
                }

                lastFocusedLyricsId = 'output-lyrics-b';
                showStatus('A/B ë¹„êµ ëª¨ë“œ ON! ğŸ­', 'success');
            } else {
                singleContainer.classList.remove('hidden');
                abContainer.classList.add('hidden');
                toggleBtn.classList.remove('bg-indigo-600/70');
                showStatus('ë‹¨ì¼ ëª¨ë“œë¡œ ì „í™˜! ğŸ“', 'info');
            }
            debounceReport();
        }

        function useVersion(which) {
            const text = (which === 'A') ? versionALyrics : versionBLyrics;
            if (!text || text.includes('ì—¬ê¸°ì—')) {
                showStatus(`ë²„ì „ ${which} ê°€ì‚¬ê°€ ì—†ì–´! âš ï¸`, 'error');
                return;
            }
            $('output-lyrics').innerText = text;
            showStatus(`ë²„ì „ ${which}ë¥¼ ë©”ì¸ ê°€ì‚¬ë¡œ ì„ íƒ! âœ…`, 'success');
            toggleABMode();
        }

        function loadHistory() {
            try {
                historyData = JSON.parse(localStorage.getItem(STORAGE.HISTORY) || '[]');
            } catch {
                historyData = [];
            }
        }

        function saveToHistory(data) {
            const newItem = { id: Date.now(), date: new Date().toLocaleString('ko-KR'), ...data };
            historyData.unshift(newItem);
            if (historyData.length > 30) historyData.pop();
            localStorage.setItem(STORAGE.HISTORY, JSON.stringify(historyData));
        }

        function clearHistory() {
            if (confirm('ì •ë§ ëª¨ë“  ê¸°ë¡ì„ ì§€ìš¸ê¹Œ?')) {
                historyData = [];
                localStorage.removeItem(STORAGE.HISTORY);
                renderHistory();
                showStatus('ë³´ê´€í•¨ì´ ë¹„ì›Œì¡Œì–´!', 'success');
            }
        }

        // v9.2: ì´ë²¤íŠ¸ ìœ„ì„ìœ¼ë¡œ ë³´ê´€í•¨ ì•ˆì „í™”
        function renderHistory() {
            const list = $('history-list');
            if (!historyData || historyData.length === 0) {
                list.innerHTML = '<div class="text-center text-slate-500 py-10"><i class="fas fa-box-open text-4xl opacity-50"></i><p class="mt-4">ì•„ì§ ì €ì¥ëœ ëª…ê³¡ì´ ì—†ì–´!</p></div>';
                return;
            }

            list.innerHTML = '';
            for (const item of historyData) {
                const card = document.createElement('div');
                card.className = 'glass p-4 rounded-xl border-l-4 border-blue-500 hover:bg-slate-800/50 transition-colors';
                card.innerHTML = `
                    <div class="flex justify-between items-start mb-2">
                        <div>
                            <span class="text-xs text-blue-300 font-bold px-2 py-0.5 rounded bg-blue-900/50">${escapeHtml(item.genre)}</span>
                            <span class="text-xs text-slate-400 ml-2">${escapeHtml(item.date)}</span>
                        </div>
                        <button class="text-slate-500 hover:text-red-400" data-history-action="delete" data-id="${item.id}"><i class="fas fa-trash"></i></button>
                    </div>
                    <h4 class="font-bold text-lg mb-2 text-white">${escapeHtml(item.keyword)}</h4>
                    <div class="grid grid-cols-4 gap-2 text-xs">
                        <button class="p-2 bg-slate-700 rounded hover:bg-purple-600 transition-colors" data-history-action="copy" data-field="lyrics" data-id="${item.id}"><i class="fas fa-file-alt"></i> ê°€ì‚¬</button>
                        <button class="p-2 bg-slate-700 rounded hover:bg-emerald-600 transition-colors" data-history-action="copy" data-field="style" data-id="${item.id}"><i class="fas fa-music"></i> ìŠ¤íƒ€ì¼</button>
                        <button class="p-2 bg-slate-700 rounded hover:bg-rose-600 transition-colors" data-history-action="copy" data-field="video" data-id="${item.id}"><i class="fas fa-video"></i> ì˜ìƒ</button>
                        <button class="p-2 bg-slate-700 rounded hover:bg-yellow-600 transition-colors" data-history-action="copy" data-field="art" data-id="${item.id}"><i class="fas fa-image"></i> ì»¤ë²„</button>
                    </div>
                `;
                list.appendChild(card);
            }
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = String(text ?? '');
            return div.innerHTML;
        }

        function deleteHistoryItem(id) {
            historyData = historyData.filter(item => item.id !== id);
            localStorage.setItem(STORAGE.HISTORY, JSON.stringify(historyData));
            renderHistory();
            showStatus('ê¸°ë¡ ì‚­ì œ ì™„ë£Œ! ğŸ—‘ï¸', 'success');
        }

        function getHistoryItem(id) {
            return historyData.find(item => item.id === id);
        }

        // v9.2: AI ë¦¬í¬íŠ¸ ê°œì„  (ì„¹ì…˜ ì§€ì‹œë¬¸ ì œì™¸)
        function generateAIReport(lyrics) {
            const lines = lyrics.split('\n').map(l => l.trim()).filter(l => {
                if (!l) return false;
                if (l.startsWith('[')) return false;
                if (/^\([A-Za-z][A-Za-z\s'!?.-]{0,28}\)$/.test(l)) return true;
                if (l.startsWith('(')) return false;
                return true;
            });

            const syllableCounts = lines.map(line => {
                const korean = line.replace(/[^\u3131-\uD79D]/g, '');
                return korean.length;
            }).filter(c => c > 0);

            const avgSyllables = syllableCounts.length > 0 ? (syllableCounts.reduce((a,b) => a+b, 0) / syllableCounts.length).toFixed(1) : 0;

            const finalChorusMatch = lyrics.match(/\[Final Chorus\]([\s\S]*?)(\[|$)/);
            const finalChorusLines = finalChorusMatch ? finalChorusMatch[1].split('\n').map(l => l.trim()).filter(l => l && !l.startsWith('(')).length : 0;

            const hyphens = (lyrics.match(/-/g) || []).length;
            const counterpointMatches = lyrics.match(/\(([A-Za-z][A-Za-z\s'!?.-]{0,28})\)/g) || [];
            const counterpoint = counterpointMatches.length;

            const chorusMatches = lyrics.match(/\[Chorus\]([\s\S]*?)(?=\[|$)/g) || [];
            const uniqueChorusRatio = chorusMatches.length > 1 ? ((new Set(chorusMatches).size / chorusMatches.length) * 100).toFixed(0) : 100;

            let report = '';

            const syllableOK = avgSyllables >= 3 && avgSyllables <= 5.5;
            report += `<div class="flex items-start gap-2 ${syllableOK ? 'text-green-300' : 'text-yellow-300'}">`;
            report += `<i class="fas ${syllableOK ? 'fa-check-circle text-green-400' : 'fa-exclamation-triangle text-yellow-400'} mt-0.5"></i>`;
            report += `<span>ìŒì ˆìˆ˜: í‰ê·  ${avgSyllables}ìŒì ˆ ${syllableOK ? '(ì•ˆì •ê¶Œ)' : avgSyllables > 6 ? '(ë„ˆë¬´ ê¹€!)' : '(ì§§ìŒ)'}</span></div>`;

            const finalOK = finalChorusLines > 0 && finalChorusLines <= 8;
            report += `<div class="flex items-start gap-2 ${finalOK ? 'text-green-300' : 'text-red-300'}">`;
            report += `<i class="fas ${finalOK ? 'fa-check-circle text-green-400' : 'fa-times-circle text-red-400'} mt-0.5"></i>`;
            report += `<span>Final Chorus: ${finalChorusLines}ì¤„ ${finalOK ? '(ì•ˆì „)' : '(ìœ„í—˜!)'}</span></div>`;

            const cpOK = counterpoint >= 1 && counterpoint <= 6;
            report += `<div class="flex items-start gap-2 ${cpOK ? 'text-green-300' : 'text-yellow-300'}">`;
            report += `<i class="fas ${counterpoint >= 1 ? 'fa-check-circle text-green-400' : 'fa-info-circle text-yellow-400'} mt-0.5"></i>`;
            report += `<span>ëŒ€ìœ„ë²•: ${counterpoint}íšŒ ${cpOK ? '(ì ì •)' : '(ë¶€ì¡±)'}</span></div>`;

            const hyOK = hyphens >= 12 && hyphens <= 40;
            report += `<div class="flex items-start gap-2 ${hyOK ? 'text-green-300' : 'text-yellow-300'}">`;
            report += `<i class="fas ${hyOK ? 'fa-check-circle text-green-400' : 'fa-exclamation-triangle text-yellow-400'} mt-0.5"></i>`;
            report += `<span>í•˜ì´í”ˆ: ${hyphens}ê°œ ${hyOK ? '(ê¶Œì¥)' : '(ì¡°ì • í•„ìš”)'}</span></div>`;

            const chOK = uniqueChorusRatio >= 70;
            report += `<div class="flex items-start gap-2 ${chOK ? 'text-green-300' : 'text-red-300'}">`;
            report += `<i class="fas ${chOK ? 'fa-check-circle text-green-400' : 'fa-times-circle text-red-400'} mt-0.5"></i>`;
            report += `<span>ì½”ëŸ¬ìŠ¤ ë³€ì£¼ìœ¨: ${uniqueChorusRatio}% ${chOK ? '(ìš°ìˆ˜)' : '(ë‚®ìŒ)'}</span></div>`;

            $('report-content').innerHTML = report;
            $('ai-report').classList.remove('hidden');
        }

        const VOCAL_MODIFIERS = {
            'default': '',
            'husky': ', husky raspy tone with emotional grit',
            'clear': ', clear bright crystalline voice with pristine clarity',
            'powerful': ', powerful belting voice with commanding presence',
            'whispery': ', whispery breathy intimate delivery',
            'smooth': ', smooth mellow silky tone with warmth',
            'emotional': ', deeply emotional sorrowful voice full of pain'
        };

        const GENRE_FUSION_MODIFIERS = {
            'jazz': ' with jazz elements, swing rhythms, sophisticated chord progressions',
            'rock': ' with rock elements, electric guitar riffs, driving drums',
            'electronic': ' with electronic elements, synthesized textures, modern production',
            'classical': ' with classical orchestration, string arrangements, refined dynamics',
            'hiphop': ' with hip-hop elements, rhythmic beats, urban groove',
            'folk': ' with folk elements, acoustic instrumentation, organic warmth'
        };

        const VOCAL_CONFIG_MODIFIERS = {
            'solo': '',
            'duet': ', featuring male-female duet with harmonized vocals and alternating verses',
            'group': ', featuring 3-4 member vocal group with rich layered harmonies'
        };

        const EMOTION_INTENSITY_MAP = {
            low: ', subtle and restrained emotional delivery with gentle nuance',
            medium: ', balanced emotional expression with controlled dynamics',
            high: ', intense and passionate delivery with dramatic emotional peaks'
        };

        const MOOD_MODIFIERS = {
            tone: {
                'bittersweet-hope': ' with bittersweet hopefulness',
                'grand-darkness': ' with grand epic darkness',
                'quiet-despair': ' with quiet intimate despair',
                'nostalgic-warmth': ' with nostalgic gentle warmth',
                'epic-tragedy': ' with epic tragic grandeur'
            },
            season: {
                'winter-night': ', set in a cold winter night ambiance',
                'autumn-sunset': ', set in an autumn sunset glow',
                'rainy-dawn': ', set in a rainy dawn atmosphere',
                'spring-dusk': ', set in a spring twilight mood',
                'summer-storm': ', set in a summer storm intensity'
            },
            place: {
                'empty-station': ', imagery of an empty train station',
                'old-cafe': ', imagery of an old vintage cafe',
                'rain-window': ', imagery of rain-soaked windows',
                'night-street': ', imagery of lonely night streets',
                'ocean-pier': ', imagery of a desolate ocean pier'
            },
            psychology: {
                'denial': ', psychological state of denial and avoidance',
                'acceptance': ', psychological state of gradual acceptance',
                'regret': ', psychological state of deep regret',
                'longing': ', psychological state of intense longing',
                'numbness': ', psychological state of emotional numbness'
            }
        };

        const STRUCTURE_TIMELINES = {
            'standard': { info: '3:40 (í‘œì¤€)', intro: '0:08', v1: '0:28', pre1: '0:16', c1: '0:32', break: '0:15', v2: '0:28', pre2: '0:16', c2: '0:32', bridge: '0:24', build: '0:12', final: '0:37', outro: '0:12' },
            'short': { info: '2:30 (ì‡¼ì¸ )', intro: '0:05', v1: '0:22', pre1: '0:12', c1: '0:28', break: '0:00', v2: '0:00', pre2: '0:12', c2: '0:28', bridge: '0:18', build: '0:08', final: '0:30', outro: '0:07' },
            'extended': { info: '4:30 (í’€ë²„ì „)', intro: '0:12', v1: '0:32', pre1: '0:18', c1: '0:36', break: '0:20', v2: '0:32', pre2: '0:18', c2: '0:36', bridge: '0:28', build: '0:15', final: '0:42', outro: '0:15' }
        };

        const GENRE_DATA = {
            trot: 'Create a slow to medium tempo Korean trot song with female vocals using Korean twist technique and vibrato, focusing on repressed sorrow. Add legato strings and a deep minor-key melody with varied and unexpected melodic twists.',
            ballad: 'Korean emotional ballad, medium-slow tempo, deep minor-key, melody-first composition, vocals very upfront, wide vibrato, Korean twist technique, legato strings, melancholic melodic twists, obvious changes, non-repetitive, addictive hook, no narration',
            rnb: 'R&B Ballad, Korean style, deep minor-key, medium-slow tempo, focusing on repressed sorrow, powerful climax, full-voiced lead vocal with long vibrato and Korean twist technique, layered harmonies with call-and response, stacked vocals, diverse melodies with unexpected twists, legato strings and orchestral swell, no whispery delivery, no runs, no narration',
            pop80s: '80s pop ballad with extremely sorrowful mood and deep minor-key at medium-slow tempo, warm contralto-like tone, lead vocal with layered female harmonies and angelic background vocals featuring layered counterpoint harmonies and lyrical call-and-response with distinct melodic lines, melody-driven with varied melodic lines, emotional build-up to cathartic climax with single controlled high note in final chorus, full-voiced lead vocal with expressive vibrato on sustained notes, no whispery delivery, no narration',
            europop: 'Melodic 70s Europop with a deep minor-key, fast tempo, and sad mood. Female lead with layered female harmonies, angelic background vocals. Unexpected melodic twists and varied melodies throughout. Catchy hooks, no shouting. Driving piano-driven ostinato, pulsating rhythmic foundation, lush orchestral strings, emotional build-up, polished 70s analog warmth, wide stereo field, sophisticated arrangement, dramatic melancholic energy, shimmering synthesizer layers.',
            metal: 'Symphonic Metal, Gothic Metal, deep minor-key, moderate tempo ~104-110 BPM, tragic mood, Operatic female lead, massive symphonic choir, layered counterpoint harmonies, Complex progressive arrangement, unexpected melodic twists, Heavy distorted guitar riffs, driving piano ostinato, lush orchestral strings, Cinematic build-up, epic atmosphere, wall of sound, pristine modern metal production, dramatic melancholic energy'
        };

        function loadPresetsList() {
            const presets = JSON.parse(localStorage.getItem(STORAGE.PRESETS) || '{}');
            const selector = $('preset-selector');
            while (selector.options.length > 1) selector.remove(1);
            Object.keys(presets).forEach(name => {
                const option = document.createElement('option');
                option.value = name;
                option.textContent = name;
                selector.appendChild(option);
            });
        }

        function savePreset() {
            const name = prompt('í”„ë¦¬ì…‹ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”:');
            if (!name) return;

            const preset = {
                genre: $('genre').value,
                genreFusion: $('genre-fusion').value,
                vocalColor: $('vocal-color').value,
                structure: $('structure').value,
                vocalConfig: q('input[name="vocal-config"]:checked')?.value || 'solo',
                emotionIntensity: $('emotion-intensity').value,
                moodTone: $('mood-tone').value,
                moodSeason: $('mood-season').value,
                moodPlace: $('mood-place').value,
                moodPsychology: $('mood-psychology').value
            };

            const presets = JSON.parse(localStorage.getItem(STORAGE.PRESETS) || '{}');
            presets[name] = preset;
            localStorage.setItem(STORAGE.PRESETS, JSON.stringify(presets));

            loadPresetsList();
            $('preset-selector').value = name;
            showStatus(`í”„ë¦¬ì…‹ "${name}" ì €ì¥! ğŸ’¾`, 'success');
        }

        function loadPreset() {
            const name = $('preset-selector').value;
            if (!name) return;

            const presets = JSON.parse(localStorage.getItem(STORAGE.PRESETS) || '{}');
            const preset = presets[name];
            if (!preset) return;

            $('genre').value = preset.genre;
            $('genre-fusion').value = preset.genreFusion || '';
            $('vocal-color').value = preset.vocalColor;
            $('structure').value = preset.structure;

            const radio = q(`input[name="vocal-config"][value="${preset.vocalConfig}"]`);
            if (radio) radio.checked = true;

            $('emotion-intensity').value = preset.emotionIntensity;
            $('emotion-value').textContent = preset.emotionIntensity + '%';

            $('mood-tone').value = preset.moodTone || '';
            $('mood-season').value = preset.moodSeason || '';
            $('mood-place').value = preset.moodPlace || '';
            $('mood-psychology').value = preset.moodPsychology || '';

            showStatus(`í”„ë¦¬ì…‹ "${name}" ë¶ˆëŸ¬ì˜¤ê¸°! ğŸ“‚`, 'success');
        }

        function deletePreset() {
            const name = $('preset-selector').value;
            if (!name) {
                showStatus('ì‚­ì œí•  í”„ë¦¬ì…‹ì„ ì„ íƒí•´ì¤˜! âš ï¸', 'error');
                return;
            }
            if (!confirm(`í”„ë¦¬ì…‹ "${name}"ì„(ë¥¼) ì‚­ì œí• ê¹Œ?`)) return;

            const presets = JSON.parse(localStorage.getItem(STORAGE.PRESETS) || '{}');
            delete presets[name];
            localStorage.setItem(STORAGE.PRESETS, JSON.stringify(presets));
            loadPresetsList();
            showStatus(`í”„ë¦¬ì…‹ "${name}" ì‚­ì œ! ğŸ—‘ï¸`, 'success');
        }

        async function randomKeyword() {
            if (!apiKey) {
                showStatus('API í‚¤ë¥¼ ë¨¼ì € ì„¤ì •í•´ì¤˜! âš™ï¸', 'error');
                toggleSettings(true);
                return;
            }

            const btnIcon = q('#btn-random-keyword i');
            const input = $('keyword');
            btnIcon.classList.add('fa-spin');
            input.value = 'AIê°€ ê¹Šì´ ìˆëŠ” ì˜ê°ì„ ìƒê°í•˜ëŠ” ì¤‘...';
            input.disabled = true;

            try {
                const inspirationPrompt = `Generate ONE deeply profound and emotionally resonant Korean song concept.

Requirements:
1. Focus on a SPECIFIC psychological state or human condition
2. Include concrete imagery or metaphor
3. Must evoke universal human emotions (grief, longing, regret, hope)
4. Should be story-driven

Format: [Main Concept] ([Detailed psychological context])

Output ONLY the concept in Korean, nothing else.`;

                // ì§ì ‘ Gemini API í˜¸ì¶œ (ì§§ì€ í”„ë¡¬í”„íŠ¸ë¼ ë°±ì—”ë“œ ë¶ˆí•„ìš”)
                const m = modelName || 'gemini-3-flash-preview';
                const url = `https://generativelanguage.googleapis.com/v1beta/models/${m}:generateContent?key=${apiKey}`;
                
                const response = await fetch(url, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{ parts: [{ text: inspirationPrompt }] }],
                        generationConfig: { temperature: 0.85, topK: 40, topP: 0.95, maxOutputTokens: 4096 }
                    })
                });
                
                if (!response.ok) throw new Error(`API Error: ${response.status}`);
                
                const data = await response.json();
                const result = data?.candidates?.[0]?.content?.parts?.[0]?.text || 'ìƒì„± ì‹¤íŒ¨';
                const keyword = String(result || '').replace(/```/g, '').trim();
                input.value = keyword;
                showStatus('ê¹Šì´ ìˆëŠ” ì˜ê° ìƒì„± ì™„ë£Œ! ğŸ’¡', 'success');
            } catch (err) {
                console.error(err);
                input.value = '';
                showStatus('ì˜ê° ìƒì„± ì‹¤íŒ¨! âš ï¸', 'error');
            } finally {
                btnIcon.classList.remove('fa-spin');
                input.disabled = false;
            }
        }

        // v9.2: ìƒì„± ì·¨ì†Œ ê¸°ëŠ¥
        function setGeneratingUI(on, itemCount=0) {
            generating = on;
            $('cancel-btn').classList.toggle('hidden', !on);
            $('generate-btn').disabled = on;

            if (on) {
                $('generate-btn').innerHTML = `<i class="fas fa-bolt fa-spin mr-2"></i> Gemini ì‘ë™ ì¤‘... (${itemCount}ê°œ)`;
            } else {
                $('generate-btn').innerHTML = `<span class="relative z-10"><i class="fas fa-bolt mr-2"></i> ì„ íƒí•œ í•­ëª© ìƒì„±í•˜ê¸°</span><div class="absolute inset-0 bg-white/20 translate-y-full group-hover:translate-y-0 transition-transform duration-300"></div>`;
            }
        }

        function cancelGeneration() {
            if (!generating) return;
            for (const c of activeControllers) {
                try { c.abort(); } catch {}
            }
            activeControllers = [];
            setGeneratingUI(false);
            ['output-lyrics', 'output-music-theory', 'output-translation', 'output-marketing', 'output-video', 'output-art'].forEach(id => $(id).classList.remove('shimmer'));
            showStatus('ìƒì„± ì·¨ì†Œí–ˆì–´! â›”', 'warn');
        }

        // v9.2: AbortController ì§€ì› callGemini
        // v11.0: ë°±ì—”ë“œ API í˜¸ì¶œ (í”„ë¡¬í”„íŠ¸ ë³´í˜¸!)
        async function callBackendAPI(endpoint, params, retries = 3) {
            const controller = new AbortController();
            activeControllers.push(controller);

            for (let i = 0; i < retries; i++) {
                try {
                    const response = await fetch(endpoint, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(params),
                        signal: controller.signal
                    });

                    if (!response.ok) {
                        let errorData = null;
                        try { errorData = await response.json(); } catch {}
                        
                        if (response.status === 429) {
                            throw new Error('â° ì‹œê°„ë‹¹ ìš”ì²­ í•œë„ ì´ˆê³¼ (20íšŒ/ì‹œê°„)');
                        }
                        
                        throw new Error(`HTTP ${response.status}: ${errorData?.error || 'Unknown'}`);
                    }

                    const data = await response.json();
                    return data.lyrics || data.result || data.content || 'ìƒì„± ì‹¤íŒ¨';
                    
                } catch (e) {
                    if (controller.signal.aborted) throw new Error('ABORTED');
                    console.error(`Attempt ${i + 1} failed:`, e);
                    if (i === retries - 1) throw e;
                    await new Promise(r => setTimeout(r, 900 * (i + 1)));
                }
            }
        }

        async function generateAll() {
            // ğŸ”¥ v10.5: ëª¨ë“œ ë¶„ê¸° - ê³¡ ì—°ì¥ ëª¨ë“œì¼ ë•Œ
            if (currentMode === 'extend') {
                await generateExtend();
                return;
            }
            
            // ì¼ë°˜ ìƒì„± ëª¨ë“œ
            if (!apiKey) {
                showStatus('API í‚¤ë¥¼ ë¨¼ì € ì„¤ì •í•´ì¤˜! âš™ï¸', 'error');
                toggleSettings(true);
                return;
            }

            if (generating) {
                showStatus('ì´ë¯¸ ìƒì„± ì¤‘ì´ì•¼! ğŸ˜…', 'warn');
                return;
            }

            // v9.2: ìƒˆë¡œ ìƒì„±í•  ë•Œ ê¸°ì¡´ ê°€ì‚¬ ì™„ì „íˆ ì´ˆê¸°í™”
            $('output-lyrics').innerText = 'ìƒì„± ì¤‘... ğŸµ';
            $('output-lyrics').classList.remove('placeholder-text');
            $('output-lyrics-a').innerText = 'ìƒì„± ì¤‘... ğŸµ';
            $('output-lyrics-b').innerText = 'ìƒì„± ì¤‘... ğŸµ';
            $('output-style').innerText = '';
            $('output-music-theory').innerText = '';
            $('output-translation').innerText = '';
            $('output-marketing').innerText = '';
            $('output-video').innerText = '';
            $('output-art').innerText = '';

            // v9.2: Focus Mode - ì…ë ¥ì°½ ìë™ ì ‘ê¸°
            collapseInputSection();

            activeControllers = [];

            const vocalColor = $('vocal-color').value;
            const structure = $('structure').value;
            const vocalModifier = VOCAL_MODIFIERS[vocalColor] || '';

            const genreFusion = $('genre-fusion').value;
            const vocalConfig = q('input[name="vocal-config"]:checked')?.value || 'solo';
            const emotionIntensity = parseInt($('emotion-intensity').value, 10);

            const genreFusionModifier = genreFusion ? (GENRE_FUSION_MODIFIERS[genreFusion] || '') : '';
            const vocalConfigModifier = VOCAL_CONFIG_MODIFIERS[vocalConfig] || '';

            let emotionIntensityModifier = '';
            if (emotionIntensity <= 33) emotionIntensityModifier = EMOTION_INTENSITY_MAP.low;
            else if (emotionIntensity <= 66) emotionIntensityModifier = EMOTION_INTENSITY_MAP.medium;
            else emotionIntensityModifier = EMOTION_INTENSITY_MAP.high;

            const moodTone = $('mood-tone').value;
            const moodSeason = $('mood-season').value;
            const moodPlace = $('mood-place').value;
            const moodPsychology = $('mood-psychology').value;

            let moodModifier = '';
            if (moodTone) moodModifier += MOOD_MODIFIERS.tone[moodTone] || '';
            if (moodSeason) moodModifier += MOOD_MODIFIERS.season[moodSeason] || '';
            if (moodPlace) moodModifier += MOOD_MODIFIERS.place[moodPlace] || '';
            if (moodPsychology) moodModifier += MOOD_MODIFIERS.psychology[moodPsychology] || '';

            const generateTranslation = $('opt-translation').checked;
            const generateMarketing = $('opt-marketing').checked;
            const generateVideo = $('opt-video').checked;
            const generateArt = $('opt-art').checked;
            const autoChorusVariation = $('opt-chorus-variation').checked;

            const sectionVerse = $('section-verse').value;
            const sectionPrechorus = $('section-prechorus').value;
            const sectionChorus = $('section-chorus').value;
            const sectionBridge = $('section-bridge').value;
            const sectionFinal = $('section-final').value;
            const sectionOutro = $('section-outro').value;

            const genre = $('genre').value;
            const keyword = $('keyword').value || 'ê·¸ë¦¬ì›€ê³¼ ì¶”ì–µ';

            const itemCount = 2 + (generateTranslation ? 1 : 0) + (generateMarketing ? 1 : 0) + (generateVideo ? 1 : 0) + (generateArt ? 1 : 0);
            setGeneratingUI(true, itemCount);

            $('output-lyrics').classList.add('shimmer');
            $('output-music-theory').classList.add('shimmer');
            if (generateTranslation) $('output-translation').classList.add('shimmer');
            else $('output-translation').innerText = 'âšª ìƒì„±í•˜ì§€ ì•ŠìŒ';
            if (generateMarketing) $('output-marketing').classList.add('shimmer');
            else $('output-marketing').innerText = 'âšª ìƒì„±í•˜ì§€ ì•ŠìŒ';
            if (generateVideo) $('output-video').classList.add('shimmer');
            else $('output-video').innerText = 'âšª ìƒì„±í•˜ì§€ ì•ŠìŒ';
            if (generateArt) $('output-art').classList.add('shimmer');
            else $('output-art').innerText = 'âšª ìƒì„±í•˜ì§€ ì•ŠìŒ';

            let modifiedStyle = GENRE_DATA[genre] || '';
            if (vocalModifier) modifiedStyle += vocalModifier;
            if (genreFusionModifier) modifiedStyle += genreFusionModifier;
            if (vocalConfigModifier) modifiedStyle += vocalConfigModifier;
            if (emotionIntensityModifier) modifiedStyle += emotionIntensityModifier;
            if (moodModifier) modifiedStyle += moodModifier;
            $('output-style').innerText = modifiedStyle;

            try {
                // v11.0: ë°±ì—”ë“œ APIë¡œ ê°€ì‚¬ ìƒì„± (í”„ë¡¬í”„íŠ¸ëŠ” ë°±ì—”ë“œì—ì„œ ì²˜ë¦¬!)
                const lyricsParams = {
                    userApiKey: apiKey,
                    modelName: modelName || 'gemini-3-flash-preview',
                    keyword,
                    genre,
                    structure,
                    vocalModifier,
                    genreFusionModifier,
                    vocalConfigModifier,
                    emotionIntensityModifier,
                    moodModifier,
                    autoChorusVariation,
                    sectionVerse,
                    sectionPrechorus,
                    sectionChorus,
                    sectionBridge,
                    sectionFinal,
                    sectionOutro,
                    abModeActive
                };
                
                const promises = [
                    callBackendAPI('/api/generate-lyrics', lyricsParams),
                    callBackendAPI('/api/generate-music-theory', { 
                        userApiKey: apiKey, 
                        keyword, 
                        genre, 
                        emotionIntensity 
                    })
                ];
                // Optional ê¸°ëŠ¥ë“¤ë„ ë°±ì—”ë“œ API ì‚¬ìš©
                if (generateTranslation) {
                    promises.push(callBackendAPI('/api/generate-optional', {
                        userApiKey: apiKey,
                        type: 'translation',
                        keyword,
                        genre
                    }));
                }
                if (generateMarketing) {
                    promises.push(callBackendAPI('/api/generate-optional', {
                        userApiKey: apiKey,
                        type: 'marketing',
                        keyword,
                        genre
                    }));
                }
                if (generateVideo) {
                    promises.push(callBackendAPI('/api/generate-optional', {
                        userApiKey: apiKey,
                        type: 'video',
                        keyword,
                        genre
                    }));
                }
                if (generateArt) {
                    promises.push(callBackendAPI('/api/generate-optional', {
                        userApiKey: apiKey,
                        type: 'art',
                        keyword,
                        genre
                    }));
                }

                const results = await Promise.all(promises);

                const lyricsText = results[0];
                const musicTheoryText = results[1];

                let translationText = 'âšª ìƒì„±í•˜ì§€ ì•ŠìŒ';
                let marketingText = 'âšª ìƒì„±í•˜ì§€ ì•ŠìŒ';
                let videoText = 'âšª ìƒì„±í•˜ì§€ ì•ŠìŒ';
                let artText = 'âšª ìƒì„±í•˜ì§€ ì•ŠìŒ';

                let idx = 2;
                if (generateTranslation) translationText = results[idx++];
                if (generateMarketing) marketingText = results[idx++];
                if (generateVideo) videoText = results[idx++];
                if (generateArt) artText = results[idx++];

                if (abModeActive) {
                    versionBLyrics = lyricsText;
                    $('output-lyrics-b').innerText = lyricsText;
                    lastFocusedLyricsId = 'output-lyrics-b';
                    showStatus('ë²„ì „ B ìƒì„± ì™„ë£Œ! ğŸ­', 'success');
                } else {
                    $('output-lyrics').innerText = lyricsText;
                }

                $('output-music-theory').innerText = musicTheoryText;
                $('output-translation').innerText = translationText;
                $('output-marketing').innerText = marketingText;
                $('output-video').innerText = videoText;
                $('output-art').innerText = artText;

                generateAIReport(lyricsText);

                saveToHistory({
                    genre,
                    keyword,
                    lyrics: lyricsText,
                    style: modifiedStyle,
                    video: videoText,
                    art: artText,
                    marketing: marketingText
                });

                showStatus(`ëª…ê³¡ ì™„ì„±! ${itemCount}ê°œ í•­ëª© ìƒì„± ğŸ’¾`, 'success');

            } catch (err) {
                console.error(err);
                if (String(err?.message).includes('ABORTED')) {
                    showStatus('ìš”ì²­ ì·¨ì†Œë¨! ğŸ˜', 'warn');
                } else {
                    showStatus('ì˜¤ë¥˜ ë°œìƒ! âš ï¸', 'error');
                }
            } finally {
                setGeneratingUI(false);
                activeControllers = [];
                ['output-lyrics', 'output-music-theory', 'output-translation', 'output-marketing', 'output-video', 'output-art'].forEach(id => $(id).classList.remove('shimmer'));
            }
        }

        // ğŸ”¥ v10.5: ê³¡ ì—°ì¥(Extend) ìƒì„± í•¨ìˆ˜
        async function generateExtend() {
            const verse1 = $('extend-verse1-inline').value.trim();
            const chorus = $('extend-chorus-inline').value.trim();
            
            if (!verse1 || !chorus) {
                showStatus('âš ï¸ 1ì ˆê³¼ í›„ë ´ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”!', 'error');
                return;
            }
            
            if (!apiKey) {
                showStatus('âš ï¸ API í‚¤ë¥¼ ë¨¼ì € ì„¤ì •í•´ì£¼ì„¸ìš”!', 'error');
                toggleSettings();
                return;
            }
            
            if (generating) {
                showStatus('ì´ë¯¸ ìƒì„± ì¤‘ì´ì•¼! ğŸ˜…', 'warn');
                return;
            }
            
            // ì´ˆê¸°í™”
            $('output-lyrics').innerText = 'ìƒì„± ì¤‘... ğŸ”—';
            $('output-lyrics').classList.remove('placeholder-text');
            collapseInputSection();
            
            const genre = $('genre').value;
            const keyword = $('keyword').value || 'ê°ì„± ë°œë¼ë“œ';
            const structure = $('structure').value;
            
            setGeneratingUI(true);
            
            try {
                const API_BASE_URL = window.location.origin;
                const response = await fetch(`${API_BASE_URL}/api/generate-extend`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        userApiKey: apiKey,
                        modelName: modelName,
                        existingVerse1: verse1,
                        existingChorus: chorus,
                        genre: genre,
                        keyword: keyword,
                        structure: structure
                    })
                });
                
                if (!response.ok) {
                    const errorData = await response.json().catch(() => null);
                    throw new Error(errorData?.error || 'Extend ìƒì„± ì‹¤íŒ¨');
                }
                
                const data = await response.json();
                
                // ê²°ê³¼ í‘œì‹œ
                $('output-lyrics').innerText = data.extension;
                
                // ìŠ¤í¬ë¡¤ ì´ë™
                document.getElementById('output-lyrics').scrollIntoView({ behavior: 'smooth' });
                
                showStatus('âœ… 2ì ˆ/Bridge ìƒì„± ì™„ë£Œ!', 'success');
                
            } catch (error) {
                console.error('Extend Error:', error);
                showStatus('âŒ ' + error.message, 'error');
            } finally {
                setGeneratingUI(false);
            }
        }

        function toggleSectionDirecting() {
            const panel = $('section-directing-panel');
            const icon = $('section-toggle-icon');
            if (panel.classList.contains('hidden')) {
                panel.classList.remove('hidden');
                icon.className = 'fas fa-chevron-up';
            } else {
                panel.classList.add('hidden');
                icon.className = 'fas fa-chevron-down';
            }
        }

        // v9.2: Input Section ì ‘ê¸°/í¼ì¹˜ê¸°
        function toggleInputSection() {
            const content = $('input-content');
            const icon = $('input-collapse-icon');
            
            if (content.classList.contains('collapsed')) {
                content.classList.remove('collapsed');
                content.classList.add('expanded');
                icon.classList.remove('rotated');
            } else {
                content.classList.add('collapsed');
                content.classList.remove('expanded');
                icon.classList.add('rotated');
            }
        }

        // v9.2: Emotion Section ì ‘ê¸°/í¼ì¹˜ê¸°
        function toggleEmotionSection() {
            const content = $('emotion-content');
            const icon = $('emotion-collapse-icon');
            
            if (content.classList.contains('collapsed')) {
                content.classList.remove('collapsed');
                content.classList.add('expanded');
                icon.classList.remove('rotated');
            } else {
                content.classList.add('collapsed');
                content.classList.remove('expanded');
                icon.classList.add('rotated');
            }
        }

        // v9.2: Input Section ìë™ ì ‘ê¸° (Focus Mode)
        function collapseInputSection() {
            const content = $('input-content');
            const icon = $('input-collapse-icon');
            
            content.classList.add('collapsed');
            content.classList.remove('expanded');
            icon.classList.add('rotated');
        }

        // ===== ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì—°ê²° =====
        function wireEvents() {
            // ğŸŒŸ v10.5: ê°„í¸/ê³ ê¸‰ ëª¨ë“œ ì „í™˜
            let uiMode = localStorage.getItem('uiMode') || 'simple'; // 'simple' or 'advanced'
            let selectedGenre = 'pop80s'; // ê°„í¸ ëª¨ë“œ ê¸°ë³¸ ì¥ë¥´
            
            // ëª¨ë“œ ì´ˆê¸°í™”
            if (uiMode === 'simple') {
                $('mode-simple').classList.add('active');
                $('mode-advanced').classList.remove('active');
                $('simple-mode-content').classList.add('active');
                $('advanced-mode-content').classList.remove('active');
            } else {
                $('mode-advanced').classList.add('active');
                $('mode-simple').classList.remove('active');
                $('advanced-mode-content').classList.add('active');
                $('simple-mode-content').classList.remove('active');
            }
            
            // ê°„í¸ ëª¨ë“œ ë²„íŠ¼ í´ë¦­
            $('mode-simple').addEventListener('click', () => {
                uiMode = 'simple';
                localStorage.setItem('uiMode', 'simple');
                
                $('mode-simple').classList.add('active');
                $('mode-advanced').classList.remove('active');
                $('simple-mode-content').classList.add('active');
                $('advanced-mode-content').classList.remove('active');
                
                showStatus('ğŸŒŸ ê°„í¸ ëª¨ë“œë¡œ ì „í™˜! 3ë‹¨ê³„ë§Œ ì…ë ¥í•˜ë©´ ì™„ì„±!', 'success');
            });
            
            // ê³ ê¸‰ ëª¨ë“œ ë²„íŠ¼ í´ë¦­
            $('mode-advanced').addEventListener('click', () => {
                uiMode = 'advanced';
                localStorage.setItem('uiMode', 'advanced');
                
                $('mode-advanced').classList.add('active');
                $('mode-simple').classList.remove('active');
                $('advanced-mode-content').classList.add('active');
                $('simple-mode-content').classList.remove('active');
                
                showStatus('âš™ï¸ ê³ ê¸‰ ëª¨ë“œë¡œ ì „í™˜! ëª¨ë“  ì˜µì…˜ì„ ì‚¬ìš©í•  ìˆ˜ ìˆì–´!', 'success');
            });
            
            // ê°„í¸ ëª¨ë“œ - ì¥ë¥´ ì¹´ë“œ ì„ íƒ
            qa('.genre-card').forEach(card => {
                card.addEventListener('click', () => {
                    // ëª¨ë“  ì¹´ë“œ ì„ íƒ í•´ì œ
                    qa('.genre-card').forEach(c => c.classList.remove('selected'));
                    // í˜„ì¬ ì¹´ë“œ ì„ íƒ
                    card.classList.add('selected');
                    selectedGenre = card.dataset.genre;
                });
            });
            
            // ê°„í¸ ëª¨ë“œ - ê¸°ë³¸ ì¥ë¥´ ì„ íƒ (ë°œë¼ë“œ)
            const defaultCard = q('.genre-card[data-genre="pop80s"]');
            if (defaultCard) defaultCard.classList.add('selected');
            
            // ê°„í¸ ëª¨ë“œ - ëœë¤ ì˜ê° ë²„íŠ¼
            $('simple-random-keyword').addEventListener('click', async () => {
                if (!apiKey) {
                    showStatus('âš ï¸ API í‚¤ë¥¼ ë¨¼ì € ì„¤ì •í•´ì£¼ì„¸ìš”!', 'error');
                    toggleSettings();
                    return;
                }
                
                const btn = $('simple-random-keyword');
                const originalHTML = btn.innerHTML;
                btn.disabled = true;
                btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i>';
                
                try {
                    const response = await fetch(`${window.location.origin}/api/generate-keyword`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            userApiKey: apiKey,
                            modelName: modelName
                        })
                    });
                    
                    if (!response.ok) throw new Error('ëœë¤ ì˜ê° ìƒì„± ì‹¤íŒ¨');
                    
                    const data = await response.json();
                    $('simple-keyword').value = data.keyword;
                    showStatus('âœ¨ ëœë¤ ì˜ê° ì™„ì„±!', 'success');
                    
                } catch (error) {
                    showStatus('âŒ ' + error.message, 'error');
                } finally {
                    btn.disabled = false;
                    btn.innerHTML = originalHTML;
                }
            });
            
            // ê°„í¸ ëª¨ë“œ - ìƒì„± ë²„íŠ¼
            $('simple-generate-btn').addEventListener('click', async () => {
                const keyword = $('simple-keyword').value.trim();
                
                if (!keyword) {
                    showStatus('âš ï¸ 1ë‹¨ê³„ì—ì„œ ì£¼ì œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”!', 'error');
                    $('simple-keyword').focus();
                    return;
                }
                
                if (!apiKey) {
                    showStatus('âš ï¸ API í‚¤ë¥¼ ë¨¼ì € ì„¤ì •í•´ì£¼ì„¸ìš”! (ìš°ì¸¡ ìƒë‹¨ ì„¤ì • ë²„íŠ¼)', 'error');
                    toggleSettings();
                    return;
                }
                
                // ê³ ê¸‰ ëª¨ë“œ í•„ë“œì— ìë™ ì…ë ¥
                $('keyword').value = keyword;
                $('genre').value = selectedGenre;
                
                // ê¸°ë³¸ê°’ ì„¤ì •
                $('genre-fusion').value = '';
                $('vocal-color').value = 'basic';
                $('structure').value = 'standard';
                q('input[name="vocal-config"][value="solo"]').checked = true;
                $('emotion-intensity').value = '70';
                
                // ìƒì„± ì˜µì…˜ - ê°„í¸ ëª¨ë“œ ì²´í¬ë°•ìŠ¤ ê°’ ë°˜ì˜
                $('opt-lyrics').checked = true; // í•­ìƒ í•„ìˆ˜
                $('opt-marketing').checked = $('simple-opt-marketing').checked;
                $('opt-video').checked = $('simple-opt-video').checked;
                $('opt-art').checked = $('simple-opt-art').checked;
                $('opt-translation').checked = $('simple-opt-translation').checked;
                $('opt-chorus-variation').checked = $('simple-opt-chorus-variation').checked;
                
                // ì¼ë°˜ ìƒì„± ì‹¤í–‰
                await generateAll();
            });
            
            // ğŸ”¥ v10.5: íƒ­ ì „í™˜ (ì¼ë°˜ ìƒì„± / ê³¡ ì—°ì¥)
            let currentMode = 'normal'; // 'normal' or 'extend'
            
            $('tab-normal').addEventListener('click', () => {
                currentMode = 'normal';
                $('tab-normal').classList.add('active');
                $('tab-extend').classList.remove('active');
                $('normal-mode-content').classList.add('active');
                $('extend-mode-content').classList.remove('active');
                $('generate-btn-text').textContent = 'ì„ íƒí•œ í•­ëª© ìƒì„±í•˜ê¸°';
            });
            
            $('tab-extend').addEventListener('click', () => {
                currentMode = 'extend';
                $('tab-extend').classList.add('active');
                $('tab-normal').classList.remove('active');
                $('extend-mode-content').classList.add('active');
                $('normal-mode-content').classList.remove('active');
                $('generate-btn-text').textContent = 'âœ¨ 2ì ˆ/Bridge ìƒì„±í•˜ê¸°';
            });
            
            // Clear All
            $('btn-clear-all').addEventListener('click', clearAllOutputs);
            
            // v9.2: ì ‘ê¸°/í¼ì¹˜ê¸°
            $('input-header').addEventListener('click', toggleInputSection);
            $('emotion-header').addEventListener('click', toggleEmotionSection);
            
            // Settings
            $('btn-settings').addEventListener('click', () => toggleSettings());
            $('btn-settings-close').addEventListener('click', () => toggleSettings(false));
            $('btn-save-key').addEventListener('click', () => {
                const key = $('api-key').value.trim();
                const model = $('model-select').value;
                const sessionOnly = $('key-session-only').checked;
                
                // TTS ì„¤ì •
                const ttsKey = $('tts-api-key').value.trim();
                const ttsVoice = $('tts-voice-select').value;
                const ttsEnabled = $('tts-enable').checked;

                if (!key) {
                    showStatus('API í‚¤ë¥¼ ì…ë ¥í•´ì¤˜! âš ï¸', 'error');
                    return;
                }

                apiKey = key;
                modelName = model;
                
                // TTS ì„¤ì • ì €ì¥
                ttsApiKey = ttsKey;
                ttsVoiceName = ttsVoice;
                useTTS = ttsEnabled;

                // v9.2: ì €ì¥ ë°©ì‹ ì„ íƒ
                if (sessionOnly) {
                    sessionStorage.setItem(STORAGE.KEY_SESSION, key);
                    localStorage.removeItem(STORAGE.KEY_LOCAL);
                } else {
                    localStorage.setItem(STORAGE.KEY_LOCAL, key);
                    sessionStorage.removeItem(STORAGE.KEY_SESSION);
                }

                localStorage.setItem(STORAGE.MODEL, model);
                
                // TTS ì„¤ì • ë¡œì»¬ ì €ì¥
                if (ttsKey) localStorage.setItem(STORAGE.TTS_KEY, ttsKey);
                else localStorage.removeItem(STORAGE.TTS_KEY);
                localStorage.setItem(STORAGE.TTS_VOICE, ttsVoice);
                localStorage.setItem(STORAGE.TTS_ENABLED, ttsEnabled);
                
                toggleSettings(false);
                showStatus('ì„¤ì • ì €ì¥ ì™„ë£Œ! ğŸ‰', 'success');
            });

            // History
            $('btn-history').addEventListener('click', () => toggleHistory());
            $('btn-history-close').addEventListener('click', () => toggleHistory(false));
            $('btn-clear-history').addEventListener('click', clearHistory);

            // v9.2: ì´ë²¤íŠ¸ ìœ„ì„ (ë³´ê´€í•¨ ì•ˆì „í™”)
            $('history-list').addEventListener('click', (e) => {
                const btn = e.target.closest('button[data-history-action]');
                if (!btn) return;

                const action = btn.dataset.historyAction;
                const id = parseInt(btn.dataset.id, 10);

                if (action === 'delete') {
                    deleteHistoryItem(id);
                } else if (action === 'copy') {
                    const field = btn.dataset.field;
                    const item = getHistoryItem(id);
                    if (!item) return;

                    const fieldMap = {
                        'lyrics': item.lyrics,
                        'style': item.style,
                        'video': item.video,
                        'art': item.art
                    };

                    const text = fieldMap[field];
                    if (text) copyText(text);
                    else showStatus('ë³µì‚¬í•  ë°ì´í„°ê°€ ì—†ì–´! âš ï¸', 'error');
                }
            });

            // Main Actions
            $('generate-btn').addEventListener('click', generateAll);
            $('cancel-btn').addEventListener('click', cancelGeneration);
            $('btn-random-keyword').addEventListener('click', randomKeyword);

            // Presets
            $('btn-save-preset').addEventListener('click', savePreset);
            $('btn-delete-preset').addEventListener('click', deletePreset);
            $('preset-selector').addEventListener('change', loadPreset);

            // Section Directing
            $('btn-toggle-section').addEventListener('click', toggleSectionDirecting);

            // AB Mode
            $('ab-toggle-btn').addEventListener('click', toggleABMode);
            qa('button[data-use]').forEach(btn => {
                btn.addEventListener('click', () => useVersion(btn.dataset.use));
            });
            qa('button[data-tts]').forEach(btn => {
                btn.addEventListener('click', () => {
                    const version = btn.dataset.tts;
                    if (version === 'A') performTTS('output-lyrics-a', 'tts-icon-a', 'A');
                    else performTTS('output-lyrics-b', 'tts-icon-b', 'B');
                });
            });

            // TTS Main
            $('tts-btn').addEventListener('click', toggleTTSMain);

            // v9.2: í¸ì§‘ ëª¨ë“œ
            $('edit-toggle-btn').addEventListener('click', toggleEditMode);

            // v9.2: ì‹¤ì‹œê°„ ë¦¬í¬íŠ¸ ê°±ì‹  (í¸ì§‘ ì¤‘)
            $('output-lyrics').addEventListener('input', debounceReport);
            $('output-lyrics-a').addEventListener('input', debounceReport);
            $('output-lyrics-b').addEventListener('input', debounceReport);

            // Focus tracking (A/B ëª¨ë“œ)
            ['output-lyrics-a', 'output-lyrics-b'].forEach(id => {
                $(id).addEventListener('focus', () => { lastFocusedLyricsId = id; });
            });

            // Export
            $('export-lyrics-btn').addEventListener('click', exportLyrics);

            // Copy buttons (ì¼ë°˜)
            qa('button[data-copy]').forEach(btn => {
                btn.addEventListener('click', () => copyFromElement(btn.dataset.copy));
            });

            // Insert Tags (ê¸°ì¡´ ë²„íŠ¼ - í˜„ì¬ëŠ” ì‚¬ìš© ì•ˆ í•¨)
            qa('button[data-insert-tag]').forEach(btn => {
                btn.addEventListener('click', () => insertTag(btn.dataset.insertTag));
            });

            // v9.2: ìŒí–¥íš¨ê³¼ 4ê°œ ë“œë¡­ë‹¤ìš´ (ì„ íƒ â†’ ìœ„ì¹˜ ì„ íƒ ëª¨ë‹¬!)
            const sfxNames = {
                '[Heavy Rain]': 'ğŸŒ§ï¸ í­ìš°',
                '[Thunder]': 'âš¡ ì²œë‘¥',
                '[Ocean Waves]': 'ğŸŒŠ íŒŒë„',
                '[Wind]': 'ğŸ’¨ ë°”ëŒ',
                '[Birds Chirping]': 'ğŸ¦ ìƒˆì†Œë¦¬',
                '[Fire Crackling]': 'ğŸ”¥ ë¶ˆíƒ€ëŠ”ì†Œë¦¬',
                '[Vinyl Crackle]': 'ğŸ“€ ë°”ì´ë‹ ì¡ìŒ',
                '[Lo-fi]': 'ğŸ§ ë¡œíŒŒì´',
                '[Echo Chamber]': 'ğŸ”Š ì—ì½”',
                '[Reverb]': 'ğŸ¤ ë¦¬ë²„ë¸Œ',
                '[Silence]': 'ğŸ”‡ ì •ì ',
                '[Orchestral Hit]': 'ğŸ» ì˜¤ì¼€ìŠ¤íŠ¸ë¼ íƒ€ê²©',
                '[Piano Solo]': 'ğŸ¹ í”¼ì•„ë…¸ ì†”ë¡œ',
                '[Strings Swell]': 'ğŸ¼ í˜„ì•… ìŠ¤ì›°',
                '[Guitar Riff]': 'ğŸ¸ ê¸°íƒ€ ë¦¬í”„',
                '[Crowd Cheering]': 'ğŸ‘ í™˜í˜¸ì„±',
                '[Applause]': 'ğŸ‘ ë°•ìˆ˜',
                '[Laughter]': 'ğŸ˜„ ì›ƒìŒì†Œë¦¬',
                '[Heartbeat]': 'ğŸ’— ì‹¬ì¥ë°•ë™',
                '[Footsteps]': 'ğŸ‘£ ë°œì†Œë¦¬'
            };

            ['sfx-nature', 'sfx-mood', 'sfx-instrument', 'sfx-crowd'].forEach(id => {
                $(id).addEventListener('change', (e) => {
                    const tag = e.target.value;
                    if (tag) {
                        const displayName = sfxNames[tag] || tag;
                        showSFXPositionModal(tag, displayName);
                        e.target.value = ''; // ì„ íƒ ì´ˆê¸°í™”
                    }
                });
            });

            // ìŒí–¥íš¨ê³¼ ìœ„ì¹˜ ì„ íƒ ë²„íŠ¼ë“¤
            qa('.sfx-position-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    const position = btn.dataset.position;
                    insertSFXAtPosition(pendingSFXTag, position);
                });
            });

            // ìŒí–¥íš¨ê³¼ ëª¨ë‹¬ ì·¨ì†Œ
            $('sfx-position-cancel').addEventListener('click', hideSFXPositionModal);

            // ğŸ”— v10.5: Extend ëª¨ë‹¬ ì´ë²¤íŠ¸ (ëª¨ë‹¬ì€ ìœ ì§€, ì´ë²¤íŠ¸ë§Œ ì •ë¦¬)
            $('btn-extend-close').addEventListener('click', () => {
                $('extend-modal').classList.add('hidden');
            });

            $('btn-extend-close-2').addEventListener('click', () => {
                $('extend-modal').classList.add('hidden');
            });

            // Emotion Intensity Slider
            $('emotion-intensity').addEventListener('input', (e) => {
                $('emotion-value').textContent = e.target.value + '%';
            });

            // ESC key to close modals
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') {
                    if (!$('settings-modal').classList.contains('hidden')) toggleSettings(false);
                    if (!$('history-modal').classList.contains('hidden')) toggleHistory(false);
                }
            });
        }

        // ===== ì´ˆê¸°í™” =====
        function init() {
            // v9.2: API í‚¤ ë¶ˆëŸ¬ì˜¤ê¸° (ì„¸ì…˜ ìš°ì„ )
            apiKey = sessionStorage.getItem(STORAGE.KEY_SESSION) || localStorage.getItem(STORAGE.KEY_LOCAL) || '';
            if (apiKey) {
                $('api-key').value = apiKey;
                const isSession = !!sessionStorage.getItem(STORAGE.KEY_SESSION);
                $('key-session-only').checked = isSession;
            }

            // v9.2: ëª¨ë¸ ì„ íƒ ë¶ˆëŸ¬ì˜¤ê¸°
            const savedModel = localStorage.getItem(STORAGE.MODEL);
            if (savedModel) {
                modelName = savedModel;
                $('model-select').value = savedModel;
            }

            // Google Cloud TTS ì„¤ì • ë¶ˆëŸ¬ì˜¤ê¸°
            ttsApiKey = localStorage.getItem(STORAGE.TTS_KEY) || '';
            ttsVoiceName = localStorage.getItem(STORAGE.TTS_VOICE) || 'ko-KR-Neural2-A';
            useTTS = localStorage.getItem(STORAGE.TTS_ENABLED) === 'true';
            
            if (ttsApiKey) $('tts-api-key').value = ttsApiKey;
            $('tts-voice-select').value = ttsVoiceName;
            $('tts-enable').checked = useTTS;

            loadHistory();
            loadPresetsList();
            wireEvents();

            // v9.2: TTS ìŒì„± ë¡œë”© ê°œì„  (Chrome/Safari ë¹„ë™ê¸° ì²˜ë¦¬)
            if ('speechSynthesis' in window) {
                loadVoices();
                window.speechSynthesis.onvoiceschanged = loadVoices;
            }

            showStatus('v10.5 ULTIMATE Edition ì¤€ë¹„ ì™„ë£Œ! ğŸš€ (ê³¡ ì—°ì¥ ëª¨ë“œ ì¶”ê°€!)', 'success');
        }

        // Page load
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', init);
        } else {
            init();
        }

        // Cleanup TTS on page unload
        window.addEventListener('beforeunload', () => {
            if (ttsActive || ttsActiveA || ttsActiveB) {
                stopAllTTS();
            }
        });
    </script>
</body>
</html>
